<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><link rel="canonical" href="https://www.jetbrains.com/help/mps/generator-cookbook.html" data-react-helmet="true"/><meta charset="UTF-8"></meta><meta name="built-on" content="2024-08-08T15:14:23.298374497"><meta name="build-number" content="170"><title>Generator cookbook | MPS Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"howdoesthegeneratorprocesstherules?","level":0,"title":"How does the generator process the rules?","anchor":"#howdoesthegeneratorprocesstherules?"},{"id":"canihavemoregeneratorsforasinglelanguage?","level":0,"title":"Can I have more generators for a single language?","anchor":"#canihavemoregeneratorsforasinglelanguage?"},{"id":"canihavemultiplemappingconfigurationspergenerator?","level":0,"title":"Can I have multiple mapping configurations per generator?","anchor":"#canihavemultiplemappingconfigurationspergenerator?"},{"id":"howtogeneratemultipletargetsfromsinglesource?","level":0,"title":"How to generate multiple targets from single source?","anchor":"#howtogeneratemultipletargetsfromsinglesource?"},{"id":"whatmacrosareavailableinthetemplates?","level":0,"title":"What macros are available in the templates?","anchor":"#whatmacrosareavailableinthetemplates?"},{"id":"whereshallipututilityclasses?","level":0,"title":"Where do I put utility classes?","anchor":"#whereshallipututilityclasses?"},{"id":"whereshalliputruntimeclasses?","level":0,"title":"Where do I put runtime classes?","anchor":"#whereshalliputruntimeclasses?"},{"id":"howdoigenerateuniquenames?","level":0,"title":"How do I generate unique names?","anchor":"#howdoigenerateuniquenames?"},{"id":"howtogenerateenumerationdatatypes?","level":0,"title":"How to generate enumeration datatypes?","anchor":"#howtogenerateenumerationdatatypes?"},{"id":"howtoichangepackagesofthegeneratedjavaclasses?","level":0,"title":"How to I change packages of the generated Java classes?","anchor":"#howtoichangepackagesofthegeneratedjavaclasses?"},{"id":"whatisthedifferencebetweenrootmappingrulesandreductionrules?","level":0,"title":"What is the difference between root mapping rules and reduction rules?","anchor":"#whatisthedifferencebetweenrootmappingrulesandreductionrules?"},{"id":"whathappenstountransformedroots?","level":0,"title":"What happens to untransformed roots?","anchor":"#whathappenstountransformedroots?"},{"id":"howtogeneratemultiplenodesforasinglenode?","level":0,"title":"How to generate multiple nodes for a single node?","anchor":"#howtogeneratemultiplenodesforasinglenode?"},{"id":"whyiseditingthemacrossoweird?","level":0,"title":"Why is editing the macros so weird?","anchor":"#whyiseditingthemacrossoweird?"},{"id":"howcanigeneraterootnodesfornon-rootnodes?","level":0,"title":"How can I generate root nodes for non-root nodes?","anchor":"#howcanigeneraterootnodesfornon-rootnodes?"},{"id":"howtoremoveno-longerneededrootsfromthemodel?","level":0,"title":"How to remove no-longer needed roots from the model?","anchor":"#howtoremoveno-longerneededrootsfromthemodel?"},{"id":"howdoigeneratenodesfornodesinaccessorymodels?","level":0,"title":"How do I generate nodes for nodes in accessory models?","anchor":"#howdoigeneratenodesfornodesinaccessorymodels?"},{"id":"howtousemappinglabels?","level":0,"title":"How to use mapping labels?","anchor":"#howtousemappinglabels?"},{"id":"howtohandlereferencesduringgeneration?","level":0,"title":"How to handle references during generation?","anchor":"#howtohandlereferencesduringgeneration?"},{"id":"canidebugthegenerationprocess?","level":0,"title":"Can I debug the generation process?","anchor":"#canidebugthegenerationprocess?"},{"id":"howdoifigureouttheactualgenerationsteps?","level":0,"title":"How do I figure out the actual generation steps?","anchor":"#howdoifigureouttheactualgenerationsteps?"},{"id":"canispecifytheorderinwhichgeneratorsshouldberun?","level":0,"title":"Can I specify the order in which generators should be run?","anchor":"#canispecifytheorderinwhichgeneratorsshouldberun?"},{"id":"howtocheckthatthemodelhasnoerrorsbeforestartingthegenerator?","level":0,"title":"How to check that the model has no errors before starting the generator?","anchor":"#howtocheckthatthemodelhasnoerrorsbeforestartingthegenerator?"},{"id":"howtoextendanexistinggenerator?","level":0,"title":"How to extend an existing generator?","anchor":"#howtoextendanexistinggenerator?"},{"id":"howtobuildanextensiblegenerator?","level":0,"title":"How to build an extensible generator?","anchor":"#howtobuildanextensiblegenerator?"},{"id":"whatshalliusetextgenfor?","level":0,"title":"What should I use TextGen for?","anchor":"#whatshalliusetextgenfor?"},{"id":"howtocopygeneratedoutput?","level":0,"title":"How to copy the generated output to a different location?","anchor":"#howtocopygeneratedoutput?"},{"id":"howtogeneratemultiplefilesperrootnode?","level":0,"title":"How to generate multiple files per root node?","anchor":"#howtogeneratemultiplefilesperrootnode?"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/storage/help-app/v6/app.css" rel="stylesheet"><link rel="manifest" href="https://www.jetbrains.com/site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Generator cookbook | MPS"><meta property="og:description" content=""><meta property="og:image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><meta property="og:site_name" content="MPS Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://www.jetbrains.com/help/mps/generator-cookbook.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@jetbrains_MPS"><meta name="twitter:title" content="Generator cookbook | MPS"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@jetbrains_MPS"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://www.jetbrains.com/help/mps/generator-cookbook.html#webpage",
    "url": "https://www.jetbrains.com/help/mps/generator-cookbook.html",
    "name": "Generator cookbook | MPS",
    "description": "",
    "image": "https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://www.jetbrains.com/help/mps/#website",
    "url": "https://www.jetbrains.com/help/mps/",
    "name": "MPS Help"
}</script><!-- End Schema.org --><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
</head><body data-id="generator-cookbook" data-main-title="Generator cookbook" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="mps-user-s-guide.topic|MPS User's Guide///mps-tutorials.topic|Tutorials"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>MPS 2024.1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="generator-cookbook" id="generator-cookbook.topic">Generator cookbook</h1><p id="m0d95d_1">This document is intended to give answers to the most common questions related to the MPS generator. You may alternatively consult the <a href="mps-generator.html" id="m0d95d_2">Generator documentation</a> and check out the <a href="generator-demos.html" id="m0d95d_3">Generator demos</a>.</p><section class="chapter"><h2 id="howdoesthegeneratorprocesstherules?" data-toc="howdoesthegeneratorprocesstherules?">How does the generator process the rules?</h2><p id="m0d95d_4">Generation gradually converts an input model into an output model, which may or may not be then turned into text with TextGen. The generation process itself consists of steps. Each step has three phases:</p><ol class="list _decimal" id="m0d95d_5" type="1"><li class="list__item" id="m0d95d_6"><p>Executing pre-mapping scripts</p></li><li class="list__item" id="m0d95d_7"><p>Template-based model transformation</p></li><li class="list__item" id="m0d95d_8"><p>Executing post-mapping scripts</p></li></ol><p id="m0d95d_9">The template-based model transformation phase consists of one or more micro-steps. A micro-step is a single-pass model transformation of and input model into a transient (output) model. The generator during a generation step will iterate over the model and search in the generators of all&nbsp;languages involved in this step for rules applicable to the nodes in the input model. When no applicable rules are found, the generation step stops. The next generation step (if any) will receive the output model of previous generation step as its input.</p><p id="m0d95d_10">You can check out <a href="mps-generator.html" id="m0d95d_11">full description of the generator algorithm</a> in the generator documentation.</p></section><section class="chapter"><h2 id="canihavemoregeneratorsforasinglelanguage?" data-toc="canihavemoregeneratorsforasinglelanguage?">Can I have more generators for a single language?</h2><p id="m0d95d_12">No, MPS only allows one generator per language at the moment. If you need several generators for a language, it is advisable to create empty languages that extend your language and in each of these extending languages to define the desired alternative generators.</p></section><section class="chapter"><h2 id="canihavemultiplemappingconfigurationspergenerator?" data-toc="canihavemultiplemappingconfigurationspergenerator?">Can I have multiple mapping configurations per generator?</h2><p id="m0d95d_13">Yes, they will all be treated as equal during the generation process. Additionally, each <em id="m0d95d_14">mapping configuration</em>&nbsp;can have its generation process <b id="m0d95d_15">priority</b> specified separately, which gives you more flexibility to tune the generation.</p></section><section class="chapter"><h2 id="howtogeneratemultipletargetsfromsinglesource?" data-toc="howtogeneratemultipletargetsfromsinglesource?">How to generate multiple targets from single source?</h2><p id="m0d95d_16">You may want to generate code for several target platforms from the same code-base. There are at least two ways you can achieve that:</p><ul class="list _bullet" id="m0d95d_17"><li class="list__item" id="m0d95d_18"><p>Put all the generation rules for different platforms into a single generator, perhaps logically separated into virtual packages and multiple mapping configurations, and use the&nbsp;<em id="m0d95d_19">condition</em>&nbsp;of each rule to activate the rule based on the currently selected target. The developer will indicate the intended target platform by setting a&nbsp;<b id="m0d95d_20">flag</b>&nbsp;in her code</p></li><li class="list__item" id="m0d95d_21"><p>Have no generator in you language directly and provide generators for each target platform in a separate&nbsp;<b id="m0d95d_22">empty</b>&nbsp;language, which extends the original language. The developer will select the desired target platform by importing the appropriate extension language.</p></li></ul></section><section class="chapter"><h2 id="whatmacrosareavailableinthetemplates?" data-toc="whatmacrosareavailableinthetemplates?">What macros are available in the templates?</h2><ul class="list _bullet" id="m0d95d_23"><li class="list__item" id="m0d95d_24"><p><b id="m0d95d_25">property macro</b>&nbsp;- computes a value for a property</p></li><li class="list__item" id="m0d95d_26"><p><b id="m0d95d_27">reference macro</b>&nbsp;- computes the target (node) of a reference</p></li><li class="list__item" id="m0d95d_28"><p><b id="m0d95d_29">node macro</b>&nbsp;- is used to control template filling at generation time</p><ul class="list _bullet" id="m0d95d_30"><li class="list__item" id="m0d95d_31"><p>$IF$ - conditional generation</p></li><li class="list__item" id="m0d95d_32"><p>$CALL$ - insert another template at the current position and process it passing in the current node</p></li><li class="list__item" id="m0d95d_33"><p>$LOOP$ - iterate over a collection of nodes and set the current node for each iteration</p></li><li class="list__item" id="m0d95d_34"><p>$COPY_SRC$ - copies the specified node and replaces the wrapped node. Reduction rules are applied to the copied node and its children during the process</p></li><li class="list__item" id="m0d95d_35"><p>$COPY_SRCL$ -&nbsp;copies the specified collection of nodes and replaces the wrapped code. Reduction rules are applied to the copied nodes and their children during the process</p></li><li class="list__item" id="m0d95d_36"><p>$MAP_SRC$ - sets a node to be used as the current node inside the wrapped code</p></li><li class="list__item" id="m0d95d_37"><p>$MAP_SRCL$ -&nbsp;sets a collection of nodes, each of which should to be used in turn as the current nodes inside the wrapped code</p></li><li class="list__item" id="m0d95d_38"><p>$SWITCH$ - chooses the template to use for generation from multiple choices</p></li><li class="list__item" id="m0d95d_39"><p>$LABEL$ - stores the wrapped node in a&nbsp;<em id="m0d95d_40">mapping label</em>&nbsp;for easy discovery by other macros</p></li><li class="list__item" id="m0d95d_41"><p>$VAR$ - sets a value into a variable, which will then be accessible in the wrapped nodes through&nbsp;<em id="m0d95d_42">genContext.varName</em></p></li><li class="list__item" id="m0d95d_43"><p>$TRACE$ - stores information required to trace back the original node for the wrapped node and stores the mapping between a source node and the resulting generated text into the <em id="m0d95d_44">trace.info</em> file - when <em id="m0d95d_45">Save Transient Models</em>&nbsp;is on, this enables the <b id="m0d95d_46">Reveal Origin Node</b>&nbsp;option in the <b id="m0d95d_47">Debug</b>&nbsp;pop-up menu item in transient models</p></li><li class="list__item" id="m0d95d_48"><p>$WEAVE$ - invokes a specific weaving rule</p></li><li class="list__item" id="m0d95d_49"><p>$INSERT$ - inserts a node into the output model at the current position</p></li></ul></li></ul></section><section class="chapter"><h2 id="whereshallipututilityclasses?" data-toc="whereshallipututilityclasses?">Where do I put utility classes?</h2><p id="m0d95d_50">Create a new model inside the generator. Make sure it does not have the <em id="m0d95d_51">generator</em>&nbsp;stereotype attached to it.&nbsp;The model should typically depend on&nbsp;<em id="m0d95d_52">BaseLanguage</em>&nbsp;so that you can create classes in it. The original <em id="m0d95d_53">generator</em>&nbsp;model should then import the utility model.</p></section><section class="chapter"><h2 id="whereshalliputruntimeclasses?" data-toc="whereshalliputruntimeclasses?">Where do I put runtime classes?</h2><p id="m0d95d_54">Classes and libraries that the generated code relies on should be put into separate&nbsp;<b id="m0d95d_55">runtime solutions</b>, as described in the "<a href="getting-the-dependencies-right.html" id="m0d95d_56">Adding external Java classes and jars to a project - runtime solutions</a>" section of <a href="getting-the-dependencies-right.html" id="m0d95d_57">Getting the dependencies right</a>.</p></section><section class="chapter"><h2 id="howdoigenerateuniquenames?" data-toc="howdoigenerateuniquenames?">How do I generate unique names?</h2><p id="m0d95d_58">Use the <em id="m0d95d_59">genContext</em>&nbsp;parameter, which gives you access to the generator context object and call:</p><ul class="list _none" id="m0d95d_60"><li class="list__item" id="m0d95d_61"><p><em id="m0d95d_62">unique name from &lt;base name&gt; in context &lt;node&gt;</em></p></li><li class="list__item" id="m0d95d_63"><p><em id="m0d95d_64">base name</em>&nbsp;- is an arbitrary string that must be part of the generated name</p></li><li class="list__item" id="m0d95d_65"><p id="m0d95d_66"><em id="m0d95d_67">context node</em>&nbsp;-&nbsp;If specified, then MPS tries its best to generated names 'contained' in a scope (usually a root node). Then when names are re-calculated (due to changes in input model or in generator model), this won't affect other names outside the scope. The&nbsp;<b id="m0d95d_68">context node</b>&nbsp;parameter is optional, though we recommend to specify it to guarantee generation stability.</p><p id="m0d95d_69">The uniqueness of generated names is secured throughout the whole generation session.</p><p id="m0d95d_70">Clashing with names that weren't generated using this service is still possible.</p></li></ul></section><section class="chapter"><h2 id="howtogenerateenumerationdatatypes?" data-toc="howtogenerateenumerationdatatypes?">How to generate enumeration datatypes?</h2><p id="m0d95d_71">Having to reduce an enumeration datatype into a Java enum, using the <em id="m0d95d_72">$SWITCH$</em>&nbsp;macro is usually the best option.</p><figure id="m0d95d_73"><img alt="Generator2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Generator2.png" title="Generator2.png" width="721" height="347"></figure><p id="m0d95d_74">Notice the way the actual enumeration datatype is tested for equality using the <em id="m0d95d_75">is()</em>&nbsp;method:</p><figure id="m0d95d_76"><img alt="Generator3.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Generator3.png" title="Generator3.png" width="1404" height="1188"></figure></section><section class="chapter"><h2 id="howtoichangepackagesofthegeneratedjavaclasses?" data-toc="howtoichangepackagesofthegeneratedjavaclasses?">How to I change packages of the generated Java classes?</h2><p id="m0d95d_77">When generating complex Java code, Java classes, interfaces and enums frequently need to be organized into packages. By default, the MPS generator reflects the structure of MPS models in the structure of the packages of the generated Java code. Each BaseLanguage model translates into a Java package with the same name. If you need to manipulate the structure of the generated Java packages, use the&nbsp;<em id="m0d95d_78">packageName</em> property of the&nbsp;<code class="code" id="m0d95d_79">Classifier</code>&nbsp;concept. The property is available for root classifiers:</p><figure id="m0d95d_80"><img alt="cp_iface.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/cp_iface.png" title="cp_iface.png" width="400" height="279"></figure></section><section class="chapter"><h2 id="whatisthedifferencebetweenrootmappingrulesandreductionrules?" data-toc="whatisthedifferencebetweenrootmappingrulesandreductionrules?">What is the difference between root mapping rules and reduction rules?</h2><p id="m0d95d_81">During generation models, which have the form of a tree (Abstract Syntax Tree, refer to <a href="basic-notions.html" id="m0d95d_82">Basic notions</a>), are translated into the generated models, which are also trees. Typically root nodes are generated into root nodes (e.g. a robot <em id="m0d95d_83">Script</em> into a Java class) and non-root nodes into non-root nodes (e.g. a robot <em id="m0d95d_84">Step</em> command into a Java <em id="m0d95d_85">BlockStatement</em>). Thus templates for root mapping rules represent a starting point of the generated model and cannot specify template context, unlike reduction templates, which may hold context and indicate the actual generation contents with the&nbsp;<b id="m0d95d_86">template fragment</b> marks.</p><aside class="prompt" data-type="warning" data-title="" id="m0d95d_87"><p id="m0d95d_88">Nodes of rootable concepts, when positioned in a non-root location, will have reduction rules applied to them. Root mapping rules are only applied to nodes in root positions.</p></aside></section><section class="chapter"><h2 id="whathappenstountransformedroots?" data-toc="whathappenstountransformedroots?">What happens to untransformed roots?</h2><p id="m0d95d_89">Roots, for which there are no applicable transformation rules, are carried unchanged over to the next generation step.</p></section><section class="chapter"><h2 id="howtogeneratemultiplenodesforasinglenode?" data-toc="howtogeneratemultiplenodesforasinglenode?">How to generate multiple nodes for a single node?</h2><p id="m0d95d_90">A template fragment in a template indicates, which node will be replacing the current input node. A template fragment can only be attached to a single node inside the template, but a generator template can contain multiple template fragments, provided the are all attached to nodes in the same role under the same parent. This way multiple nodes can be generated for a single input node.</p><figure id="m0d95d_91"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/templateFragments.png" class="lightbox"><img alt="templateFragments.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/templateFragments.png" title="templateFragments.png" width="300" height="89"></a></figure></section><section class="chapter"><h2 id="whyiseditingthemacrossoweird?" data-toc="whyiseditingthemacrossoweird?">Why is editing the macros so weird?</h2><p id="m0d95d_92">Indeed, the generator macros and template fragment marks are a bit rough to edit at first. But once you understand the underlying principles of how they work, you'll be able to use them efficiently.</p><p id="m0d95d_93">The macros have been implemented as&nbsp;<b id="m0d95d_94">Node/property/reference attributes</b> (see&nbsp;the&nbsp;<b id="m0d95d_95">Attributes</b>&nbsp;section of the&nbsp;<a href="structure.html" id="m0d95d_96">Structure</a>&nbsp;chapter). As such, they can be used in any language and do not require any up-front support to be available in that language. This is important, because any language can be used as a generation target in MPS. Macros are thus attributes attached to the node that they wrap. Deleting or replacing the node wrapped by a macro will delete the macro as well and you have to re-enter the macro to attach it to a new node. A recommended approach is to enter the code for the template first and then start adding macros. If you need to change the node wrapped by a macro, you can at least preserve the&nbsp;<b id="m0d95d_97">Inspector</b> window contents on the macro on the old node by copy-pasting it into the macro on the new node.</p></section><section class="chapter"><h2 id="howcanigeneraterootnodesfornon-rootnodes?" data-toc="howcanigeneraterootnodesfornon-rootnodes?">How can I generate root nodes for non-root nodes?</h2><p id="m0d95d_98">Simply create a <b id="m0d95d_99">root mapping rule</b> for the concept, perhaps further restrict it with a condition. The rule is called <b id="m0d95d_100">root</b>, because it generates a root node, not necessarily that it takes a root as input.</p><p id="m0d95d_101">Alternatively you can either use&nbsp;<b id="m0d95d_102">conditional root rules</b>, which insert root nodes based on evaluating a boolean predicate, or with&nbsp;<b id="m0d95d_103">pre-processing scripts</b>, which can inspect the input model and create root nodes as needed.</p></section><section class="chapter"><h2 id="howtoremoveno-longerneededrootsfromthemodel?" data-toc="howtoremoveno-longerneededrootsfromthemodel?">How to remove no-longer needed roots from the model?</h2><p id="m0d95d_104">Root nodes are removed automatically once they have been transformed using root mapping rules. For roots that are not directly transformed use the <b id="m0d95d_105">abandon root</b> rule to prevent them from being propagated into the next generation step.</p></section><section class="chapter"><h2 id="howdoigeneratenodesfornodesinaccessorymodels?" data-toc="howdoigeneratenodesfornodesinaccessorymodels?">How do I generate nodes for nodes in accessory models?</h2><p id="m0d95d_106">Nodes in the accessory models are not handled by the generator in any way. In order to generate nodes based on nodes in accessory models, you can leverage either the&nbsp;<b id="m0d95d_107">conditional root rules</b>, or&nbsp;<b id="m0d95d_108">pre-procesing scripts</b>.</p><figure id="m0d95d_109"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/accessoryGeneration.png" class="lightbox"><img alt="accessoryGeneration.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/accessoryGeneration.png" title="accessoryGeneration.png" width="500" height="167"></a></figure><p id="m0d95d_110">Reduction rules can then be used to further generate the "inserted nodes" into the desired target language.</p></section><section class="chapter"><h2 id="howtousemappinglabels?" data-toc="howtousemappinglabels?">How to use mapping labels?</h2><p id="m0d95d_111">Mapping labels are defined in mapping configurations (e.g.&nbsp;<em id="m0d95d_112">main</em>). They must then be populated by wrapping the node that you want to be stored with macros, such as $LOOP$, $LABEL$, $COPY_SRC$ and others.</p></section><section class="chapter"><h2 id="howtohandlereferencesduringgeneration?" data-toc="howtohandlereferencesduringgeneration?">How to handle references during generation?</h2><p id="m0d95d_113">Reference macros should be used to set proper target nodes on generated references. You typically use reference macros together with&nbsp;<b id="m0d95d_114">mapping</b> <b id="m0d95d_115">labels</b>.</p><p id="m0d95d_116">The fundamental task here is that for a reference&nbsp;<b id="m0d95d_117">R</b> that points to a node&nbsp;<b id="m0d95d_118">N</b>, we need to ensure that a reference <b id="m0d95d_119">G(R)</b> generated from&nbsp;<b id="m0d95d_120">R</b> must point to a node&nbsp;<b id="m0d95d_121">G(N)</b> that was generated from&nbsp;<b id="m0d95d_122">N</b>.</p><p id="m0d95d_123"><em id="m0d95d_124">if R -&gt; N, N generates to G(N), R generates into G(R)</em> <em id="m0d95d_125">then G(R) -&gt; G(N)</em></p><p id="m0d95d_126">Mapping labels serve as dictionaries, which store nodes as keys and whatever they have been generated into as values - <b id="m0d95d_127">N -&gt; G(N)</b> in our example here. The generator has to be instructed explicitly to store the mapping between a node and its generated node into a mapping label. Template fragments as well as node macros allow the user to specify a mapping label into which the generated node should be saved.</p><p id="m0d95d_128">When reducing&nbsp;<b id="m0d95d_129">R</b> into <b id="m0d95d_130">G(R)</b>, a reference macro on&nbsp;<b id="m0d95d_131">G(R)</b> can retrieve&nbsp;<b id="m0d95d_132">G(N)</b> from the mapping label using&nbsp;<b id="m0d95d_133">N</b> as a key when calling the generator context in <em id="m0d95d_134">genContext.get output by label and input</em>.</p><p id="m0d95d_135"><a href="generator-user-guide-demo7.html" id="m0d95d_136">Chapter 7</a> of the <a href="generator-demos.html" id="m0d95d_137">generator tutorial</a> covers mapping labels in more detail.</p></section><section class="chapter"><h2 id="canidebugthegenerationprocess?" data-toc="canidebugthegenerationprocess?">Can I debug the generation process?</h2><p id="m0d95d_138">The first option is to enable saving transient models.&nbsp;The intermediate models that MPS creates during generation will be preserved and you can access them in the&nbsp;<em id="m0d95d_139">Project View</em>&nbsp;panel on the left-hand side of your screen:</p><figure id="m0d95d_140"><img alt="transient1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transient1.png" title="transient1.png" width="291" height="83"></figure><figure id="m0d95d_141"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transient2.png" class="lightbox"><img alt="transient2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transient2.png" title="transient2.png" width="500" height="238"></a></figure><p id="m0d95d_142">The saved transient models allow you to investigate how the models looked like at various stages of the generation process.</p><p id="m0d95d_143">The second option is using the <b id="m0d95d_144">Generator Tracer Tool</b>. For this tool the "Save transient models" option also has to be set to <b id="m0d95d_145">on</b>. The Generator Tracer Tool gives you the ability to investigate in detail&nbsp;the generation process for a selected node.&nbsp;When you select a node in your original model or in any of the transient ones, the context menu gives you the options to either trace the generation process forward or backward. As a result you get a tree-shaped report giving you access to all the stages, through which the particular node went during generation and the rules that influence its generation.</p><figure id="m0d95d_146"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/tracer1.png" class="lightbox"><img alt="tracer1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/tracer1.png" title="tracer1.png" width="300" height="202"></a></figure><figure id="m0d95d_147"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transient2.png" class="lightbox"><img alt="transient2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transient2.png" title="transient2.png" width="300" height="143"></a></figure><p id="m0d95d_148">Additionally, the <em id="m0d95d_149">$TRACE$</em>&nbsp;generator macro gives you the option to mark parts of your templates for tracing, so that you will be able to navigate back from a generated node in a <b id="m0d95d_150">transient model</b> to its original node using the <b id="m0d95d_151">Reveal origin node</b>&nbsp;option in the <em id="m0d95d_152">Context menu -&gt; Language Debug</em>&nbsp;menu:</p><figure id="m0d95d_153"><img alt="Trace2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Trace2.png" title="Trace2.png" width="1418" height="1094"></figure><figure id="m0d95d_154"><img alt="Trace1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Trace1.png" title="Trace1.png" width="1770" height="1078"></figure></section><section class="chapter"><h2 id="howdoifigureouttheactualgenerationsteps?" data-toc="howdoifigureouttheactualgenerationsteps?">How do I figure out the actual generation steps?</h2><p id="m0d95d_155">Use the <em id="m0d95d_156">Show Generation Plan</em>&nbsp;action from the generator context menu. This will give a detailed report showing all the planned generation phases and listing the mapping configurations run in each phase.</p><figure id="m0d95d_157"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan1.png" class="lightbox"><img alt="genplan1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan1.png" title="genplan1.png" width="300" height="137"></a></figure><figure id="m0d95d_158"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan2.png" class="lightbox"><img alt="genplan2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan2.png" title="genplan2.png" width="500" height="261"></a></figure></section><section class="chapter"><h2 id="canispecifytheorderinwhichgeneratorsshouldberun?" data-toc="canispecifytheorderinwhichgeneratorsshouldberun?">Can I specify the order in which generators should be run?</h2><p id="m0d95d_159">The <em id="m0d95d_160">Generator priorities</em>&nbsp;tab in the generator's <em id="m0d95d_161">Module properties dialog</em> enables you to specify ordering rules between two distinct <em id="m0d95d_162">mappings configurations</em>.</p><figure id="m0d95d_163"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Priorities2.png" class="lightbox"><img alt="Priorities2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Priorities2.png" title="Priorities2.png" width="300" height="159"></a></figure><p id="m0d95d_164">For more complex scenarios, the new functionality of <a href="generation-plan.html" id="m0d95d_165">Generation plans</a> gives you full control over the generator process.</p></section><section class="chapter"><h2 id="howtocheckthatthemodelhasnoerrorsbeforestartingthegenerator?" data-toc="howtocheckthatthemodelhasnoerrorsbeforestartingthegenerator?">How to check that the model has no errors before starting the generator?</h2><p id="m0d95d_166">Run the <em id="m0d95d_167">Check model (language/solution)</em>&nbsp;context-menu action on the model/language/solution to check.</p><figure id="m0d95d_168"><img alt="Generator101.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Generator101.png" title="Generator101.png" width="526" height="289"></figure><p id="m0d95d_169">The&nbsp;<em id="m0d95d_170">Preferences -&gt; Build, Execution, Deployment -&gt; Generator -&gt; Check models for errors before generation</em> configuration flag specifies whether the model checker should be run automatically each time the generator is triggered.</p></section><section class="chapter"><h2 id="howtoextendanexistinggenerator?" data-toc="howtoextendanexistinggenerator?">How to extend an existing generator?</h2><p id="m0d95d_171">There is one rule to follow - make sure your extending generator is run before the extended one - give it higher priority in the generator order priority dialog.</p></section><section class="chapter"><h2 id="howtobuildanextensiblegenerator?" data-toc="howtobuildanextensiblegenerator?">How to build an extensible generator?</h2><p id="m0d95d_172">By extending the generator, extensions can alter the semantics of the original language. The MPS generator is extensible by design â it resolves all generator rules and mapping configurations from all involved languages and builds a global generation plan. Any language that is attached to the project will have its rules included. The plan specifies the execution order for the generator rules based on their mutual relative priorities expressed in mapping configurations. This enables language extensions to inject their own desired generation rules into the most suitable generation phase. Since priorities are expressed as a collection of relative ordering between mapping configurations, a language extension does not need to know about all other generators involved in generation in order to work. Potential (and rare) clashes are detected and left up to the developer to resolve. Once created, the generation plan is used to iteratively invoke the generators, potentially leveraging parallelism of the underlying hardware for mutually independent rules.</p><p id="m0d95d_173">Providing additional reduction rules is one way to extend a language. Using a Generator Switch is another option. If the parent language uses a generator switch to choose the right reduction rules, the language extension may extend that generator switch with its additional logic for picking the reduction rules â typically to include new rules contributed by extension languages.</p></section><section class="chapter"><h2 id="whatshalliusetextgenfor?" data-toc="whatshalliusetextgenfor?">What should I use TextGen for?</h2><p id="m0d95d_174">While the generator performs model-to-model transformations, TextGen does mapping to text. This is typically the last step in generation and is fully managed by the generator. Roots are picked by the generator and converted to files. The TextGen intentionally offers very little flexibility to the language designer. It is the Generator, where the generation process should primarily be configured and handled. If you feel a need to workaround the limitations of TextGen, you're most likely trying things the wrong way. Generator is the place where you have the most flexibility.</p></section><section class="chapter"><h2 id="howtocopygeneratedoutput?" data-toc="howtocopygeneratedoutput?">How to copy the generated output to a different location?</h2><p id="m0d95d_175">The <em id="m0d95d_176">CopyOutcome</em> attribute of the <em id="m0d95d_177">jetbrains.mps.lang.makeup</em> language can be used to ensure that the final generated text for a node gets copied into a specified location.</p></section><section class="chapter"><h2 id="howtogeneratemultiplefilesperrootnode?" data-toc="howtogeneratemultiplefilesperrootnode?">How to generate multiple files per root node?</h2><p id="m0d95d_178">TextGen only allows one file per root node. Also, you can only have one TextGen component per concept. The flexibility should be encoded into the generator, instead. You get the generator create multiple copies of the node, maybe wrapping each of them in a new node of different concepts. These new nodes then have their TextDef defined to perform the desired model-to-file conversions.</p></section><div class="last-modified">Last modified: 11 February 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="howto-integration-with-the-data-flow-engine.html" class="navigation-links__prev">HowTo -- Integration with the Data Flow Engine</a><a href="editor-cookbook.html" class="navigation-links__next">Editor cookbook</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/storage/help-app/v6/app.js"></script></body></html>