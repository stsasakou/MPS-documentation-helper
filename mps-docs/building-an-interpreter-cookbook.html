<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><link rel="canonical" href="https://www.jetbrains.com/help/mps/building-an-interpreter-cookbook.html" data-react-helmet="true"/><meta charset="UTF-8"></meta><meta name="built-on" content="2024-08-08T15:14:22.752132463"><meta name="build-number" content="170"><title>Building an interpreter cookbook | MPS Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"instantpreview","level":0,"title":"Instant preview","anchor":"#instantpreview"},{"id":"defininganinterpreter","level":0,"title":"Defining an Interpreter","anchor":"#defininganinterpreter"}]</script><script type="application/json" id="topic-shortcuts">{"ShowIntentionActions":{"Windows":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"PC"},"Emacs":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"PC"},"GNOME":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"PC"},"KDE":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"PC"},"Sublime Text":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"PC"},"XWin":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"PC"},"macOS":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"MAC"},"Sublime Text (macOS)":{"keystrokes":[{"keys":["mod-Alt","key-Enter"]}],"platform":"MAC"}}}</script><link href="https://resources.jetbrains.com/storage/help-app/v6/app.css" rel="stylesheet"><link rel="manifest" href="https://www.jetbrains.com/site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Building an interpreter cookbook | MPS"><meta property="og:description" content=""><meta property="og:image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><meta property="og:site_name" content="MPS Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://www.jetbrains.com/help/mps/building-an-interpreter-cookbook.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@jetbrains_MPS"><meta name="twitter:title" content="Building an interpreter cookbook | MPS"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@jetbrains_MPS"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://www.jetbrains.com/help/mps/building-an-interpreter-cookbook.html#webpage",
    "url": "https://www.jetbrains.com/help/mps/building-an-interpreter-cookbook.html",
    "name": "Building an interpreter cookbook | MPS",
    "description": "",
    "image": "https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://www.jetbrains.com/help/mps/#website",
    "url": "https://www.jetbrains.com/help/mps/",
    "name": "MPS Help"
}</script><!-- End Schema.org --><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
</head><body data-id="building-an-interpreter-cookbook" data-main-title="Building an interpreter cookbook" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="mps-user-s-guide.topic|MPS User's Guide///mps-tutorials.topic|Tutorials"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>MPS 2024.1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="building-an-interpreter-cookbook" id="building-an-interpreter-cookbook.topic">Building an interpreter cookbook</h1><p id="-ayic6w_1">Check out the <em id="-ayic6w_2">Shapes</em>&nbsp;sample project, which is bundled with MPS since version 3.1. It can do some fancy tricks in the editor.</p><aside class="prompt" data-type="tip" data-title="" id="-ayic6w_3"><p id="-ayic6w_4">The sample projects are automatically installed by MPS upon its first run and they should be located in <em id="-ayic6w_5">$USER_HOME</em> <em id="-ayic6w_6">/MPSSamples</em>.</p></aside><p id="-ayic6w_7">By default, the editor shows plain code that consists of commands to draw visual shapes of given sizes and colors on a canvas.</p><figure id="-ayic6w_8"><img alt="I1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I1.png" title="I1.png" width="411" height="117"></figure><p id="-ayic6w_9">The code can be generated into Java and run.&nbsp;This will start a new Java process running the application that just has been generated from the code above:</p><figure id="-ayic6w_10"><img alt="I4.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I4.png" title="I4.png" width="477" height="548"></figure><figure id="-ayic6w_11"><img alt="I5.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I5.png" title="I5.png" width="501" height="523"></figure><p id="-ayic6w_12">MPS can, however, also interpret the code without generating Java. Press <kbd id="-ayic6w_13" data-key="ShowIntentionActions">Alt+Enter</kbd> &nbsp;anywhere in the code to invoke the <em id="-ayic6w_14">Intentions</em>&nbsp;pop-up menu and choose "Preview Scene".&nbsp;You'll get a new frame containing your scene, which is interpreting the code:</p><figure id="-ayic6w_15"><img alt="I6.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I6.png" title="I6.png" width="420" height="147"></figure><figure id="-ayic6w_16"><img alt="I7.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I7.png" title="I7.png" width="605" height="322"></figure><section class="chapter"><h2 id="instantpreview" data-toc="instantpreview">Instant preview</h2><p id="-ayic6w_17">With the ability to interpret code the editor can now serve the results of the interpreter back to the developer through the editor. It can either interpret individual shapes and draw them in the editor next to the code that defines each of them:</p><figure id="-ayic6w_18"><img alt="I2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I2.png" title="I2.png" width="559" height="443"></figure><p id="-ayic6w_19">Or the whole scene can be drawn next to the code and react instantaneously to the changes made to the code.</p><figure id="-ayic6w_20"><img alt="I3.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I3.png" title="I3.png" width="951" height="595"></figure><p id="-ayic6w_21">To try these capabilities yourself, right-click the editor, pick "Push Editor Hints" and select the hints that will indicate to the editor, which of the preview capabilities you want to enable:</p><figure id="-ayic6w_22"><img alt="I8.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I8.png" title="I8.png" width="482" height="492"></figure><figure id="-ayic6w_23"><img alt="I9.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I9.png" title="I9.png" width="357" height="386"></figure><p id="-ayic6w_24">This was a quick teaser, now we can have a look at how to build such simple interpreting capabilities into your language.</p></section><section class="chapter"><h2 id="defininganinterpreter" data-toc="defininganinterpreter">Defining an Interpreter</h2><p id="-ayic6w_25">MPS is primarily focused on code generation. Programs represented as ASTs get translated into code in a target language, which then may get compiled and run. There are, however, situations when interpreting your code directly may be a better option. You could give the developers some sort of&nbsp;Preview&nbsp;of what the code does and thus providing instant feedback to their code changes. You could&nbsp;detect and report errors that only show at run-time Or you could just want to speed up code-run-fix cycle turnaround by bypassing the generation and compilation phases.</p><p id="-ayic6w_26">MPS does not come with any infrastructure for building interpreters at the moment, but the <em id="-ayic6w_27">Behavior</em>&nbsp;aspect of your language gives you some power to build interpreters on your own. Ideally, just like with code generators, you would create a runtime solution holding the&nbsp;interpreter runtime classes. The <em id="-ayic6w_28">Behavior</em>&nbsp;aspect of your language concepts would then cooperate with the runtime classed to navigate the AST properly and interpret all nodes in the mode.</p><p id="-ayic6w_29">We'll have a look at how the <em id="-ayic6w_30">Shapes</em>&nbsp;language enabled interpreting its code.</p><section class="chapter"><h3 id="awhole-sceneinterpreter" data-toc="awhole-sceneinterpreter">A whole-scene Interpreter</h3><p id="-ayic6w_31">Let's start with the scenario when the user invokes the interpreter explicitly by an <em id="-ayic6w_32">Intention</em>. First, the intention needs to be created:</p><figure id="-ayic6w_33"><img alt="I10.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I10.png" title="I10.png" width="1012" height="293"></figure><p id="-ayic6w_34">The intention invokes the <em id="-ayic6w_35">interpret()</em>&nbsp;method on the <em id="-ayic6w_36">Canvas</em>&nbsp;node, which is defined in the <em id="-ayic6w_37">Behavior</em>&nbsp;aspect of <em id="-ayic6w_38">Canvas</em>.</p><figure id="-ayic6w_39"><img alt="I21.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I21.png" title="I21.png" width="553" height="251"></figure><p id="-ayic6w_40">The method builds a new <em id="-ayic6w_41">Frame</em>&nbsp;that will hold a panel with a customized <em id="-ayic6w_42">paintComponent()</em>&nbsp;method. The panel is being reused by other preview functionality, so it has been extracted into a separate helper class <em id="-ayic6w_43">PreviewFactory</em>. For other than trivial cases the class should be placed into a runtime solution, but here we've just put it directly into the <em id="-ayic6w_44">Behavior</em>&nbsp;aspect of the language.</p><figure id="-ayic6w_45"><img alt="I22.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I22.png" title="I22.png" width="1137" height="369"></figure><p id="-ayic6w_46">The current model is traversed with the code: <em id="-ayic6w_47">thisCanvas.shapes.forEach({~it =&gt; it.drawShape(graphics)});</em>. This is where the interpreting happens. The <em id="-ayic6w_48">drawShape()</em>&nbsp;method is implemented by each <em id="-ayic6w_49">Shape</em>&nbsp;subconcept so that they can get rendered on the screen. Notice that the traversal code is wrapped inside a <em id="-ayic6w_50">ReadAction</em>&nbsp;to be guaranteed a read permission to the model.</p><p id="-ayic6w_51">The <em id="-ayic6w_52">drawShape()</em>&nbsp;method has to be implemented by all <em id="-ayic6w_53">Shapes:</em></p><figure id="-ayic6w_54"><img alt="I12.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I12.png" title="I12.png" width="861" height="218"></figure><figure id="-ayic6w_55"><img alt="I13.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I13.png" title="I13.png" width="879" height="236"></figure><figure id="-ayic6w_56"><img alt="I14.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I14.png" title="I14.png" width="991" height="228"></figure><p id="-ayic6w_57">This is enough to get our little interpreter off the ground.</p></section><section class="chapter"><h3 id="shapepreview" data-toc="shapepreview">Shape preview</h3><p id="-ayic6w_58">To preview individual shapes next to their definition in code, we need to change the editor or define a new one with a different <em id="-ayic6w_59">editor hint</em> ,&nbsp;so that it holds a <em id="-ayic6w_60">swing component</em>&nbsp;containing the shape's visualization. In the sample we chose to leverage multiple projections (refer to the <a href="http://www.youtube.com/watch?v=j1iPF2JjzuU" id="-ayic6w_61" data-external="true" rel="noopener noreferrer">Multiple Projections video</a>&nbsp;to see how multiple projections work in MPS) and thus we created a new editor with the <em id="-ayic6w_62">ShapePreview</em>&nbsp;hint specified in the header. Only when the user enables the <em id="-ayic6w_63">ShapePreview</em>&nbsp;hint, this editor will be used instead of the default text-only one.</p><figure id="-ayic6w_64"><img alt="I16.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I16.png" title="I16.png" width="749" height="456"></figure><p id="-ayic6w_65">The <em id="-ayic6w_66">swing component</em>&nbsp;defines a <em id="-ayic6w_67">JPanel</em>, which in the <em id="-ayic6w_68">paintComponent()</em>&nbsp;method obtains a read lock on the model and then draws the current <em id="-ayic6w_69">Shape</em>&nbsp;node at a specific location. Notice that a new <em id="-ayic6w_70">drawShapeAt()</em>&nbsp;method has been added to <em id="-ayic6w_71">Shapes</em>&nbsp;to draw the <em id="-ayic6w_72">Shapes</em>&nbsp;ignoring their defined position within the canvas.</p><figure id="-ayic6w_73"><img alt="I17.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I17.png" title="I17.png" width="564" height="318"></figure></section><section class="chapter"><h3 id="scenepreview" data-toc="scenepreview">Scene preview</h3><p id="-ayic6w_74">To preview a whole scene, we'll need to create a new editor for the <em id="-ayic6w_75">Canvas</em>&nbsp;concept and hook it to the <em id="-ayic6w_76">ScenePreview</em>&nbsp;editor hint.</p><figure id="-ayic6w_77"><img alt="I23.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/I23.png" title="I23.png" width="615" height="353"></figure><p id="-ayic6w_78">The <em id="-ayic6w_79">swing component</em>&nbsp;cell contains a customized <em id="-ayic6w_80">JPanel</em>, which is again created by the <em id="-ayic6w_81">PreviewFactory</em>&nbsp;class just like when we were interpreting on explicit user request earlier on.</p><p id="-ayic6w_82">Now, this is it. I hope you liked it.</p></section></section><div class="last-modified">Last modified: 11 February 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="cookbook-type-system.html" class="navigation-links__prev">Cookbook - Type System</a><a href="custom-language-aspect-cookbook.html" class="navigation-links__next">Custom language aspect cookbook</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/storage/help-app/v6/app.js"></script></body></html>