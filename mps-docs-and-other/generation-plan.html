<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><link rel="canonical" href="https://www.jetbrains.com/help/mps/generation-plan.html" data-react-helmet="true"/><meta charset="UTF-8"></meta><meta name="built-on" content="2024-08-08T15:14:22.313265428"><meta name="build-number" content="170"><title>Generation plan | MPS Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"generationplan","level":0,"title":"Generation plan","anchor":"#generationplan"},{"id":"generatinglanguagedescriptormodels","level":0,"title":"Generating language descriptor models","anchor":"#generatinglanguagedescriptormodels"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/storage/help-app/v6/app.css" rel="stylesheet"><link rel="manifest" href="https://www.jetbrains.com/site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Generation plan | MPS"><meta property="og:description" content=""><meta property="og:image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><meta property="og:site_name" content="MPS Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://www.jetbrains.com/help/mps/generation-plan.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@jetbrains_MPS"><meta name="twitter:title" content="Generation plan | MPS"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@jetbrains_MPS"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://www.jetbrains.com/help/mps/generation-plan.html#webpage",
    "url": "https://www.jetbrains.com/help/mps/generation-plan.html",
    "name": "Generation plan | MPS",
    "description": "",
    "image": "https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://www.jetbrains.com/help/mps/#website",
    "url": "https://www.jetbrains.com/help/mps/",
    "name": "MPS Help"
}</script><!-- End Schema.org --><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
</head><body data-id="generation-plan" data-main-title="Generation plan" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="mps-user-s-guide.topic|MPS User's Guide///language-definition.topic|Language-definition///mps-generator.topic|Generator"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>MPS 2024.1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="generation-plan" id="generation-plan.topic">Generation plan</h1><section class="chapter"><h2 id="generationplan" data-toc="generationplan">Generation plan</h2><p id="-cn0tft_1">Generation plans allow developers to specify the desired order of generation for their models explicitly and thus gain better control over the generation process.</p><section class="chapter"><h3 id="motivation" data-toc="motivation">Motivation</h3><p id="-cn0tft_2">Specifying mutual generator priorities may become cumbersome for larger projects. Additionally, in order to specify the priorities the involved languages need to know about one another by declaring appropriate mutual dependencies, which breaks their (sometimes desired) independence. Generation plans put the responsibility of proper ordering of generation steps into a single place - the generation plan. They allow language designers to provide intuitive means for end-user models to be processed in a desired order. Generation plans list all the languages that should be included in the generation process, order them appropriately and optionally specify checkpoints, at which the generator should preserve the current transient models. These models can then be used for automatic cross-model reference resolution further down the generation process.</p><aside class="prompt" data-type="tip" data-title="" id="-cn0tft_3"><p id="-cn0tft_4">The mechanism described here is a preliminary implementation that is likely to be further evolved in the following MPS versions. The general direction is:</p><ul class="list _bullet" id="-cn0tft_5"><li class="list__item" id="-cn0tft_6"><p>to give more flexibility to the language designers in how they organize builds for users of their languages</p></li><li class="list__item" id="-cn0tft_7"><p>to relieve the end-developers (aka language users) from the need to handle directly build plans, genplan models or build facets</p></li></ul><p id="-cn0tft_8">So the actual end-user mechanism is likely to become more dependent on the language designer's intentions. The approach described here, based on facet and a <b id="-cn0tft_9">genplan</b> model, is a mere sample of how to accomplish custom generation.</p></aside></section><section class="chapter"><h3 id="definingagenerationplan" data-toc="definingagenerationplan">Defining a generation plan</h3><p id="-cn0tft_10">In order to create a&nbsp;<b id="-cn0tft_11">generation plan</b>, you first need to create a model. You may consider giving the model a&nbsp;<b id="-cn0tft_12">genplan</b>&nbsp;stereotype to easily distinguish it from ordinary models, but this is not mandatory.</p><figure id="-cn0tft_13"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan4.png" class="lightbox"><img alt="genplan4.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan4.png" title="genplan4.png" width="300" height="172"></a></figure><p id="-cn0tft_14">After importing the&nbsp;<em id="-cn0tft_15">jetbrains.mps.lang.generator.plan</em> and&nbsp;<em id="-cn0tft_16">jetbrains.mps.lang.smodel</em> languages, you can create root node of the&nbsp;<em id="-cn0tft_17">Plan</em> concept, which will represent your generation plan:</p><figure id="-cn0tft_18"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan5.png" class="lightbox"><img alt="genplan5.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan5.png" title="genplan5.png" width="300" height="112"></a></figure><p id="-cn0tft_19">The generation plan consists of&nbsp;<b id="-cn0tft_20">transforms</b> and&nbsp;<b id="-cn0tft_21">checkpoints</b>.</p><figure id="-cn0tft_22"><img alt="genplan1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan1.png" title="genplan1.png" width="500" height="229"></figure><p id="-cn0tft_23">It is also possible to specify the required generators explicitly.</p><figure id="-cn0tft_24"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Gen2.png" class="lightbox"><img alt="Gen2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Gen2.png" title="Gen2.png" width="500" height="240"></a></figure><p id="-cn0tft_25"><b id="-cn0tft_26">Transform</b> represents a generation step. The <b id="-cn0tft_27">transform</b> statement is parametrized with a concrete language and with either of these options:</p><ul class="list _bullet" id="-cn0tft_28"><li class="list__item" id="-cn0tft_29"><p id="-cn0tft_30">Transform - generate the language specified.</p></li><li class="list__item" id="-cn0tft_31"><p id="-cn0tft_32">Target - run all generators for languages that manifest the specified language as their 'target' language (in langauge dependencies).</p></li><li class="list__item" id="-cn0tft_33"><p id="-cn0tft_34">Extend - run all generators for languages that manifest the specified language as their 'extended' language (in langauge dependencies).</p></li></ul><p id="-cn0tft_35"><b id="-cn0tft_36">Apply</b> represents an explicit invocation of a particular generator.&nbsp;&nbsp;The&nbsp;<em id="-cn0tft_37">apply with extended</em>&nbsp;statement applies in a single step&nbsp;the specified generators and those that extend them. This allows the language designer to accommodate for possible extensions.</p><figure id="-cn0tft_38"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Gen2.png" class="lightbox"><img alt="Gen2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Gen2.png" title="Gen2.png" width="500" height="240"></a></figure><p id="-cn0tft_39"><b id="-cn0tft_40">fork with</b> enables the plan to fork the generation process and fork off another generation plan.</p><figure id="-cn0tft_41"><img alt="ForkG.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/ForkG.png" title="ForkG.png" width="500" height="93"></figure><p id="-cn0tft_42">The referenced generation plan will start with a copy of the&nbsp;model in the state it was at the fork step and proceeds as a regular transformation.&nbsp;From this point the two generators will run independently.</p><p id="-cn0tft_43">The optional <em id="-cn0tft_44">as</em> property of <em id="-cn0tft_45">fork with</em> is a string modifier, which will serve as a trigger for the fork. The fork will only happen if the model that is being generated is owned by a module that has a facet (must be a generation target facet) with a facet id matching the string trigger.</p><p id="-cn0tft_46"><b id="-cn0tft_47">fork as</b> is an optional property of the generation plan hooks the current plan so that it forks any other generation plan without actually modifying them. The effective result is that the generation plan marked as a fork of a âmainâ generation plan will be evaluated as if it was referred to explicitly with the standard âforkâ statement inserted at the very beginning of the âmainâ generation plan. The actual value of the property is a string that serves as a trigger for the fork to happen. Identically to the <em id="-cn0tft_48">as</em> property of a <em id="-cn0tft_49">Fork with</em> statement, the fork will only happen if the model that is being generated is owned by a module that has a facet (must be a generation target facet) with a facet id matching the string guard.</p><figure id="-cn0tft_50"><img alt="Fork as in gen plan" src="https://resources.jetbrains.com/help/img/idea/2024.1/GenPlan_fork_as.png" title="Fork as in gen plan" width="300" height="115"></figure><p id="-cn0tft_51"><b id="-cn0tft_52">Checkpoints</b> represent points during the generation, at which the intermediate models should be preserved. References that will be resolved later in the generation will be able to look-up nodes in the stored intermediate models for their resolution through&nbsp;<b id="-cn0tft_53">mapping labels</b>. You can view these checkpoint models in the&nbsp;<b id="-cn0tft_54">Project View</b> tool window:</p><figure id="-cn0tft_55"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan9.png" class="lightbox"><img alt="genplan9.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan9.png" title="genplan9.png" width="300" height="346"></a></figure><p id="-cn0tft_56">These intermediate checkpoint models are preserved until you shutdown MPS or until you rebuild the models or the models that they depend on. Alternatively you can remove them manually:</p><figure id="-cn0tft_57"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan10.png" class="lightbox"><img alt="genplan10.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan10.png" title="genplan10.png" width="300" height="110"></a></figure><p id="-cn0tft_58">Checkpoints provide synchronization points between different plans. The checkpoint models are denoted with a stereotype that matches the name of a checkpoint the model has been created with. Models are persisted alongside the generated sources using the naming scheme of &lt;plan-name&gt;-&lt;checkpoint name&gt;.</p><p id="-cn0tft_59">Distinct statements allow for capturing different aspects of a checkpoint.</p><ul class="list _bullet" id="-cn0tft_60"><li class="list__item" id="-cn0tft_61"><p><em id="-cn0tft_62">declare checkpoint &lt;name&gt;</em>&nbsp;statement - specify a label that generator plans could share among themselves. This statement does not record/persist the state of the transformed model, it is a mere declaration that other generation plans will be able to refer to. <em id="-cn0tft_63"></em></p></li><li class="list__item" id="-cn0tft_64"><p><em id="-cn0tft_65">checkpoint &lt;checkpoint&gt;</em>&nbsp;-&nbsp;records/persists the state of the transformed model. It can either declare a checkpoint in-place&nbsp;or refer to a&nbsp;<em id="-cn0tft_66">declared checkpoint</em>.</p></li><li class="list__item" id="-cn0tft_67"><p><em id="-cn0tft_68">synchronize with &lt;checkpoint&gt;</em>&nbsp;statements - &nbsp;instructs the generation plan to look up the target nodes in persisted models of the specified checkpoint, but do not persist its own nodes (read-only access to the check-point). This statement doesn't introduce any new state, but references a checkpoint declared elsewhere.</p></li></ul><figure id="-cn0tft_69"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Gen1.png" class="lightbox"><img alt="Gen1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Gen1.png" title="Gen1.png" width="500" height="263"></a></figure></section><section class="chapter"><h3 id="specifyingagenerationplanformodels" data-toc="specifyingagenerationplanformodels">Specifying a generation plan for models</h3><p id="-cn0tft_70">Modules that should have their models built following a generation plan need to enable the&nbsp;<b id="-cn0tft_71">Custom generation</b> facet and point to the actual desired <b id="-cn0tft_72">generation plan</b>:</p><figure id="-cn0tft_73"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan3.png" class="lightbox"><img alt="genplan3.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan3.png" title="genplan3.png" width="500" height="282"></a></figure></section><section class="chapter"><h3 id="verifyingthegenerationplan" data-toc="verifyingthegenerationplan">Verifying the generation plan</h3><p id="-cn0tft_74">The&nbsp;<b id="-cn0tft_75">Show generation plan</b> action in the models' pop-up menu will correctly take the&nbsp;<b id="-cn0tft_76">generation plan</b> into account when building the outline for the generation:</p><figure id="-cn0tft_77"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan7.png" class="lightbox"><img alt="genplan7.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan7.png" title="genplan7.png" width="300" height="189"></a></figure><p id="-cn0tft_78">Details on the origin of the generation plan as well as clickable link to the actual plan are included it the report:</p><figure id="-cn0tft_79"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan6.png" class="lightbox"><img alt="genplan6.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan6.png" title="genplan6.png" width="500" height="254"></a></figure><p id="-cn0tft_80">If any of the used languages is not taken care by the generation plan, it is mentioned in the plan, as well:</p><figure id="-cn0tft_81"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan61.png" class="lightbox"><img alt="genplan61.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan61.png" title="genplan61.png" width="500" height="109"></a></figure><p id="-cn0tft_82">To view the original, on generator priorities based, generation plan that would be used without the explicit&nbsp;<b id="-cn0tft_83">generation plan</b> script, hold the&nbsp;<em id="-cn0tft_84">Alt</em> key while clicking the&nbsp;<em id="-cn0tft_85">Show Generation Plan</em> menu entry:</p><figure id="-cn0tft_86"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan7.png" class="lightbox"><img alt="genplan7.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan7.png" title="genplan7.png" width="300" height="189"></a></figure><figure id="-cn0tft_87"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/genplan8.png" class="lightbox"><img alt="genplan8.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/genplan8.png" title="genplan8.png" width="500" height="234"></a></figure><p id="-cn0tft_88"><em id="-cn0tft_89">Note that the report states in the header that it is not the currently active plan.</em></p><section class="chapter"><h4 id="usingdevkitstoassociateagenerationplan" data-toc="usingdevkitstoassociateagenerationplan">Using DevKits to associate a generation plan</h4><p id="-cn0tft_90">DevKits can associate a generation plan, as well.</p><figure id="-cn0tft_91"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/devkit1.png" class="lightbox"><img alt="devkit1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/devkit1.png" title="devkit1.png" width="500" height="272"></a></figure><p id="-cn0tft_92">First add dependencies on languages and solutions that the DevKit should be wrapping. Then specify the&nbsp;<b id="-cn0tft_93">Generation plan</b> from within the imported solutions, which will be associated with the DevKit.&nbsp;Any <b id="-cn0tft_94">model</b> that imports that DevKit will get the DevKit's associated generation plan applied to it.</p><figure id="-cn0tft_95"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/devkit2.png" class="lightbox"><img alt="devkit2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/devkit2.png" title="devkit2.png" width="500" height="264"></a></figure><aside class="prompt" data-type="warning" data-title="" id="-cn0tft_96"><p id="-cn0tft_97">Only one DevKit with a plan is allowed per model at the moment.</p></aside></section><section class="chapter"><h4 id="cross-modelgeneration" data-toc="cross-modelgeneration">Cross-model generation</h4><p id="-cn0tft_98"><b id="-cn0tft_99">Model</b>&nbsp;is the unit of generation in MPS. All entities in a single model are generated together and references between the nodes can be resolved with&nbsp;<b id="-cn0tft_100">reference macros</b>&nbsp;and&nbsp;<b id="-cn0tft_101">mapping labels</b>. Mapping labels, however, are not by default accessible from other models. This complicates generation of references that refer to nodes from other models. Fortunately, regular <b id="-cn0tft_102">mapping labels</b> can support mutually independent generation of models with cross-references, if the models share a&nbsp;<b id="-cn0tft_103">generation plan</b>. The mechanism leverages checkpoints to capture the intermediate transient models and then use them for reference resolution.</p><p id="-cn0tft_104">In essence, to preserve cross-model references when generating multiple models, make sure that your models share a&nbsp;<b id="-cn0tft_105">generation plan</b>. That&nbsp;<b id="-cn0tft_106">generation plan</b> must define checkpoints at moments, when the <b id="-cn0tft_107">mapping labels</b> that are used for cross-model reference resolution have been populated. The rest will be taken care of automatically. The reference macros can resolve nodes from&nbsp;<b id="-cn0tft_108">mapping labels</b> through the usual&nbsp;<em id="-cn0tft_109">genContext.get output by label and input</em> (for nodes generated through reduction or root mapping rules) or&nbsp;<em id="-cn0tft_110">genContext.get output for model</em> (for nodes generated through conditional root mapping rules) ways.</p></section></section><section class="chapter"><h3 id="linkingcheckpointmodels" data-toc="linkingcheckpointmodels">Linking checkpoint models</h3><p id="-cn0tft_111">Models created at checkpoints now keep a reference to the previous checkpoint model in the sequence. This helps the Generator discover mapped nodes matching input that spans several generator phases.</p><section class="chapter"><h4 id="debuginformationinthecheckpointmodels" data-toc="debuginformationinthecheckpointmodels">Debug information in the checkpoint models</h4><p id="-cn0tft_112">To ease debug of cross-model generation scenarios, a dedicated root inside each&nbsp;<b id="-cn0tft_113">checkpoint model</b>&nbsp;lists the mapping label names along with pointers to the stored input and output nodes. Investigation of the mapping labels exposed at each checkpoint can substantially help to debug cross-model generation scenarios and fix unresolved references. Thus, next time your cross-model reference doesn't resolve, inspect corresponding checkpoint model to see if there's indeed a label for your input.</p><figure id="-cn0tft_114"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/checkpoints1.png" class="lightbox"><img alt="checkpoints1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/checkpoints1.png" title="checkpoints1.png" width="300" height="216"></a></figure><aside class="prompt" data-type="tip" data-title="" id="-cn0tft_115"><p id="-cn0tft_116">A <a href="https://youtu.be/ktTzOg297ZQ" id="-cn0tft_117" data-external="true" rel="noopener noreferrer">video</a> on setting a generation plan for a solution as well as for a DevKit is available.</p></aside></section></section></section><section class="chapter"><h2 id="generatinglanguagedescriptormodels" data-toc="generatinglanguagedescriptormodels">Generating language descriptor models</h2><p id="-cn0tft_118">Generation plans have been enhanced to generate descriptor models for languages (known as&nbsp;<code class="code" id="-cn0tft_119">&lt;language.name&gt;@descriptor</code> ).&nbsp;The&nbsp;structure, textgen, typesystem, dataflow and constraints aspects are now generated with generation plans and they use the new cross-model reference resolution mechanism.</p><p id="-cn0tft_120">Custom aspects defined by language authors can join the generation plan, as well. If you got a custom aspect, you should make sure that its generator extends the generator of&nbsp;<code class="code" id="-cn0tft_121">jetbrains.mps.lang.descriptor</code>&nbsp;language, as this is the way to get custom extensions activated for the plan.</p></section><div class="last-modified">Last modified: 19 July 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="mapping-priorities.html" class="navigation-links__prev">Mapping Priorities</a><a href="generator-demos.html" class="navigation-links__next">Generator Demos</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/storage/help-app/v6/app.js"></script></body></html>