<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><link rel="canonical" href="https://www.jetbrains.com/help/mps/using-migrations-with-branching.html" data-react-helmet="true"/><meta charset="UTF-8"></meta><meta name="built-on" content="2024-08-08T15:14:23.416215442"><meta name="build-number" content="170"><title>Using Migrations with branching | MPS Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"usingmigrationswithbranching","level":0,"title":"Using migrations with branching","anchor":"#usingmigrationswithbranching"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/storage/help-app/v6/app.css" rel="stylesheet"><link rel="manifest" href="https://www.jetbrains.com/site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Using Migrations with branching | MPS"><meta property="og:description" content=""><meta property="og:image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><meta property="og:site_name" content="MPS Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://www.jetbrains.com/help/mps/using-migrations-with-branching.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@jetbrains_MPS"><meta name="twitter:title" content="Using Migrations with branching | MPS"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@jetbrains_MPS"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://www.jetbrains.com/help/mps/using-migrations-with-branching.html#webpage",
    "url": "https://www.jetbrains.com/help/mps/using-migrations-with-branching.html",
    "name": "Using Migrations with branching | MPS",
    "description": "",
    "image": "https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://www.jetbrains.com/help/mps/#website",
    "url": "https://www.jetbrains.com/help/mps/",
    "name": "MPS Help"
}</script><!-- End Schema.org --><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
</head><body data-id="using-migrations-with-branching" data-main-title="Using Migrations with branching" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="mps-user-s-guide.topic|MPS User's Guide///language-definition.topic|Language-definition///migrations.topic|Migrations"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>MPS 2024.1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="using-migrations-with-branching" id="using-migrations-with-branching.topic">Using Migrations with branching</h1><section class="chapter"><h2 id="usingmigrationswithbranching" data-toc="usingmigrationswithbranching">Using migrations with branching</h2><p id="-nlh28v_1">To nicely support language evolution, migrations automatically upgrade client code to use the latest version of a language or multiple languages. The <a href="migrations.html" id="-nlh28v_2">Migrations</a> documentation describes the process of creating and running migrations in MPS. Briefly,&nbsp;in order to change models to comply with the language changes, language authors can provide migrations. MPS automatically tracks language versions used in projects and asks the end-user to apply needed migrations.</p><p id="-nlh28v_3">While there are hardly any surprises when using a single branch of development, typical team setup involves multiple branches for features as well as&nbsp;bug fixes. With multiple branches teams will inevitably face situations like having different versions of languages in different branches, which makes the merge procedure much more challenging.</p><section class="chapter"><h3 id="themainruleofpainlessmerge" data-toc="themainruleofpainlessmerge">The main rule of painless merge</h3><p id="-nlh28v_4">To merge two branches smoothly, all languages used in those branches should be of the same versions. The following describes a simple workflow that allows you to easily synchronise language versions in two branches.</p><section class="chapter"><h4 id="nomigrationswerecreatedinanyofthemergedbranches" data-toc="nomigrationswerecreatedinanyofthemergedbranches">No migrations were created in any of the merged branches</h4><p id="-nlh28v_5">To sync language versions, just update languages in the outdated branch and run required migrations. Now both branches have the same versions of used languages and can be easily merged.</p></section><section class="chapter"><h4 id="somemigrationswerecreated" data-toc="somemigrationswerecreated">Some migrations were created</h4><p id="-nlh28v_6">All considered cases have the same idea behind them: <b id="-nlh28v_7">never merge branches that differ in versions of used languages</b>. Thus we need to propagate all the migrations into both branches before merging them.</p></section><section class="chapter"><h4 id="1.onemigrationwasdevelopedinoneofthebranches" data-toc="1.onemigrationwasdevelopedinoneofthebranches">1. One migration was developed in one of the branches</h4><p id="-nlh28v_8">The only special thing that should be done when you write a migration is that there should be a commit (name it C) containing the migration itself, but <b id="-nlh28v_9">no code should be migrated in the same commit</b>. The migrated files can be committed later, e.g. in the following commit.</p><p id="-nlh28v_10">The main idea here is to give other branches a possibility to get the new migration without having to merge different versions of used languages.</p><p id="-nlh28v_11">Now, your history looks like this:</p><p id="-nlh28v_12">|--- C --- &nbsp;[branch 1]</p><p id="-nlh28v_13">------|</p><p id="-nlh28v_14">|------------ &nbsp;[branch 2]</p><p id="-nlh28v_15">To merge branches b1 and b2</p><ol class="list _decimal" id="-nlh28v_16" type="1"><li class="list__item" id="-nlh28v_17"><p>Merge b2 with commit C. Now you have the new migration in b2.</p></li><li class="list__item" id="-nlh28v_18"><p>Run the migration on b2</p></li><li class="list__item" id="-nlh28v_19"><p>Merge with b1's HEAD</p></li></ol><p id="-nlh28v_20">Quite simple, isn't it?</p><aside class="prompt" data-type="tip" data-title="" id="-nlh28v_21"><p id="-nlh28v_22">It is a good habit to create a separate commit whenever you're adding a new language migration. This allows other branches to get your migration safely without having to bother with the upgrades that the migration caused to code in your branch.</p></aside></section><section class="chapter"><h4 id="2.twoormoremigrationsinoneofthebranches" data-toc="2.twoormoremigrationsinoneofthebranches">2. Two or more migrations in one of the branches</h4><p id="-nlh28v_23">The principle remains the same, it is just repeated two or more times</p><p id="-nlh28v_24">|----- C1 â C2 â &nbsp;[branch 1]</p><p id="-nlh28v_25">------|</p><p id="-nlh28v_26">|------------ &nbsp;[branch 2]</p><ol class="list _decimal" id="-nlh28v_27" type="1"><li class="list__item" id="-nlh28v_28"><p>merge b2 with C1</p></li><li class="list__item" id="-nlh28v_29"><p>run C1's migration on b2</p></li><li class="list__item" id="-nlh28v_30"><p>merge with C2</p></li><li class="list__item" id="-nlh28v_31"><p>run the migration on b2</p></li><li class="list__item" id="-nlh28v_32"><p>merge with b1</p></li></ol></section><section class="chapter"><h4 id="3.migrationswerecreatedinbothbranches" data-toc="3.migrationswerecreatedinbothbranches">3. Migrations were created in both branches</h4><p id="-nlh28v_33">In general, we recommend you to avoid this situation as it's harder to resolve. This scenario can best be avoided by having all migrations created in only one agreed-upon branch (e.g. master).</p><p id="-nlh28v_34">But if you got into this situation, here's a way to resolve it gracefully:</p><p id="-nlh28v_35">|--- C1 ----- &nbsp;[branch 1]</p><p id="-nlh28v_36">------|</p><p id="-nlh28v_37">|--- C2 ----- &nbsp;[branch 2]</p><ol class="list _decimal" id="-nlh28v_38" type="1"><li class="list__item" id="-nlh28v_39"><p>Merge b2 and C1, b1 and C2</p></li><li class="list__item" id="-nlh28v_40"><p>Run C1's migration on b2, C2's migration on b1</p></li><li class="list__item" id="-nlh28v_41"><p>merge the branches</p></li></ol></section><section class="chapter"><h4 id="preupdatecheckx2" data-toc="preupdatecheckx2">Pre-Update Check</h4><p>If at some point you end up with migrated and unmigrated code in a single branch, do not worry, we have your back. The <b id="-nlh28v_42">Pre-Update Check</b> action (<em id="-nlh28v_43">Main Menu | Migration | Run Pre-Update Check</em>) triggers an action that asks all available migrations to check whether the code is fully migrated. If nodes written using the old language versions have been merged into an already migrated branch from an un-migrated branch, these nodes will be detected and the user is offer the possibility to re-run the corresponding migrations.</p></section></section><section class="chapter"><h3 id="possibleproblemswithnodeids" data-toc="possibleproblemswithnodeids">Possible problems with Node IDs</h3><ul class="list _bullet" id="-nlh28v_44"><li class="list__item" id="-nlh28v_45"><p>If a migration sets new IDs to the migrated nodes then running migrations in two branches in parallel and then merging the two branches will result in conflicts of the migrated code.</p></li><li class="list__item" id="-nlh28v_46"><p>If a migration creates new nodes and sets their IDs to values that are random, then separate migration of two branches and then merging them will end up with conflicts again.</p></li></ul></section></section><div class="last-modified">Last modified: 11 February 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="migrations.html" class="navigation-links__prev">Migrations</a><a href="feedback.html" class="navigation-links__next">Feedback</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/storage/help-app/v6/app.js"></script></body></html>