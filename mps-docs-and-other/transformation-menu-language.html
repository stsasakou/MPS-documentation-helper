<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><link rel="canonical" href="https://www.jetbrains.com/help/mps/transformation-menu-language.html" data-react-helmet="true"/><meta charset="UTF-8"></meta><meta name="built-on" content="2024-08-08T15:14:21.257070033"><meta name="build-number" content="170"><title>Transformation Menu Language | MPS Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"overview","level":0,"title":"Overview","anchor":"#overview"},{"id":"understandingmenus","level":0,"title":"Understanding the menus","anchor":"#understandingmenus"},{"id":"definingamenu","level":0,"title":"Defining a Menu","anchor":"#definingamenu"},{"id":"sidetransformations","level":0,"title":"Side transformations","anchor":"#sidetransformations"},{"id":"substitutemenus","level":0,"title":"Substitute menus","anchor":"#substitutemenus"},{"id":"interactionofcellmenuandcell-specifictransformationmenu","level":0,"title":"Interaction of Cell Menu and Cell-specific Transformation Menu","anchor":"#interactionofcellmenuandcell-specifictransformationmenu"},{"id":"includetransformationmenufortheproperty/reference","level":0,"title":"Include transformation menu for the property/reference","anchor":"#includetransformationmenufortheproperty/reference"},{"id":"themenudiscoverymechanism","level":0,"title":"The menu discovery algorithm","anchor":"#themenudiscoverymechanism"},{"id":"showitemtrace","level":0,"title":"Show Item Trace","anchor":"#showitemtrace"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/storage/help-app/v6/app.css" rel="stylesheet"><link rel="manifest" href="https://www.jetbrains.com/site.webmanifest"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Transformation Menu Language | MPS"><meta property="og:description" content=""><meta property="og:image" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><meta property="og:site_name" content="MPS Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://www.jetbrains.com/help/mps/transformation-menu-language.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@jetbrains_MPS"><meta name="twitter:title" content="Transformation Menu Language | MPS"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@jetbrains_MPS"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://www.jetbrains.com/help/mps/transformation-menu-language.html#webpage",
    "url": "https://www.jetbrains.com/help/mps/transformation-menu-language.html",
    "name": "Transformation Menu Language | MPS",
    "description": "",
    "image": "https://resources.jetbrains.com/storage/products/mps/img/meta/preview.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://www.jetbrains.com/help/mps/#website",
    "url": "https://www.jetbrains.com/help/mps/",
    "name": "MPS Help"
}</script><!-- End Schema.org --><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
</head><body data-id="transformation-menu-language" data-main-title="Transformation Menu Language" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="mps-user-s-guide.topic|MPS User's Guide///language-definition.topic|Language-definition///editor.topic|Editor"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>MPS 2024.1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="transformation-menu-language" id="transformation-menu-language.topic">Transformation Menu Language</h1><section class="chapter"><h2 id="overview" data-toc="overview">Overview</h2><p id="s58ouq_1">Transformation menu language is used to define <em id="s58ouq_2">transformation menus</em> that describe a hierarchical structure of submenus and actions that will appear in various <em id="s58ouq_3">locations</em> in the editor. Currently there are several possible locations where transformation menus are shown: <a href="editor-actions.html" id="s58ouq_4">side transform menus</a>, <a href="editor-actions.html" id="s58ouq_5">substitute menus</a> ,&nbsp;<a href="context-assistant.html" id="s58ouq_6">context assistant</a>, and <a href="context-actions-tool.html" id="s58ouq_7">context actions tool</a>. Language designers and plugin authors can define additional locations and specify required or optional&nbsp;<em id="s58ouq_8">features</em> for each location (such as an icon or a tooltip), as documented in <a href="extending-the-transformation-menu-language.html" id="s58ouq_9">Extending the Transformation Menu Language</a>.</p><aside class="prompt" data-type="tip" data-title="" id="s58ouq_10"><p id="s58ouq_11">The <b id="s58ouq_12">Transformation Menu Language</b> provides a way to describe side-transforms and substitute actions in MPS. The core capabilities of the new approach include:</p><ul class="list _bullet" id="s58ouq_13"><li class="list__item" id="s58ouq_14"><p>the ability to explicitly specify side-transform / substitute menu content for a particular cell in the editor</p></li><li class="list__item" id="s58ouq_15"><p>no need for the "remove defaults" instruction, which often failed to work reliably in the past</p></li><li class="list__item" id="s58ouq_16"><p>easy mixing substitute actions from the substitute DSL with arbitrary /low-level/&nbsp;UI actions</p></li><li class="list__item" id="s58ouq_17"><p>the same action can be visible in different places (parts) of the editor</p></li><li class="list__item" id="s58ouq_18"><p>supporting different action sets for alternative presentations (editors/projections)</p></li><li class="list__item" id="s58ouq_19"><p>actions are now defined in the editor aspect of the language</p></li></ul></aside></section><section class="chapter"><h2 id="understandingmenus" data-toc="understandingmenus">Understanding the menus</h2><p id="s58ouq_20"><b id="s58ouq_21">Substitute menus</b> offer options to replace the current node with another one. The offered nodes must be compatible with the position into which the node is eventually going to be inserted. Thus, when the substitute menu definitions are looked up, the input to the lookup algorithm is not the concept of the existing node but rather its containment link. It's the "place" in the AST that is important, not the node that is currently occupying the place.</p><p id="s58ouq_22">Consider as an example an instance of <em id="s58ouq_23">ExpressionStatement</em> concept from BaseLanguage, which has an 'expression' child role expecting a concept of <em id="s58ouq_24">Expression</em>. Let's assume it is holding an <em id="s58ouq_25">AssignmentExpression</em> (`a = 5;`). If the user wants to replace (substitute) the <em id="s58ouq_26">AssignmentExpression</em> inside of <em id="s58ouq_27">ExpressionStatement</em> with a different node, any <em id="s58ouq_28">Expression</em> will work, because that's what the target concept of the <em id="s58ouq_29">ExpressionStatement.expression</em> containment link is. The current node is irrelevant for the purpose of finding the relevant substitute menu definitions.</p><p id="s58ouq_30">Most concepts will implicitly use a substitute menu definition that contains:</p><ul class="list _bullet" id="s58ouq_31"><li class="list__item" id="s58ouq_32"><p>An action for creating a node of this concept, unless it's abstract</p></li><li class="list__item" id="s58ouq_33"><p>An instruction to include the default menu definition of all subconcepts of this concept</p></li></ul><p id="s58ouq_34">As a result, when building a menu for <em id="s58ouq_35">Expression</em>, MPS will traverse its subconcepts and include them in the menu as well. But note that superconcepts are not considered. A completion menu for <em id="s58ouq_36">ExpressionStatement.expression</em> will not contain entries from the substitute menu definition of <em id="s58ouq_37">BaseConcept</em> because an instance of <em id="s58ouq_38">BaseConcept</em> can't be substituted there, only an <em id="s58ouq_39">Expression</em> can.</p><p id="s58ouq_40"><b id="s58ouq_41">Transformation menu</b> definitions compose in the opposite way from substitute menu definitions. Since the idea is that we want to transform an existing node, we look at its concept and go look up the transformation menu for it. If no menu is defined for that praticular concept MPS will fall back to the default menus for the superconcepts (since an instance of a concept can also be considered instance of any of its superconcepts per Liskov substitution principle). Note that if you write a default transformation menu definition then the fallback behavior does not apply and you need to specify it explicitly (using the `superconcepts menu` instruction). If you look at the default transformation menu for <em id="s58ouq_42">BaseConcept</em>, called <em id="s58ouq_43">BaseConcept_TransformationMenu</em>, you'll see that it includes the default substitute menu for the current link.</p><p id="s58ouq_44">It's not possible to attach substitute menu definitions directly to editor cells, you have to include them in a transformation menu first. The default substitute menu definition is already included in the default transformation menu definition for <em id="s58ouq_45">BaseConcept</em> so you might not need to do this if you only work with default menu definitions. The completion menu is built from transformation menu definitions. If a definition says "include this substitute menu definition" then it gets included, otherwise it doesn't.</p></section><section class="chapter"><h2 id="definingamenu" data-toc="definingamenu">Defining a Menu</h2><p id="s58ouq_46">Transformation menus define UI actions that will be shown in various locations. At design time a menu is specified as a list of sections, each section contains a list of menu&nbsp;parts for a particular set of locations.&nbsp;At runtime the menu parts and the locations are used to generate the contents of the menus (menu items).</p><p id="s58ouq_47">Menu definitions come in two flavors:&nbsp;<b id="s58ouq_48">default</b>&nbsp;and&nbsp;<b id="s58ouq_49">named</b>. Menu definitions can also be extended through&nbsp;<b id="s58ouq_50">menu contributions</b>.</p><figure id="s58ouq_51"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transformx1.png" class="lightbox"><img alt="transformx1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transformx1.png" title="transformx1.png" width="500" height="253"></a></figure><section class="chapter"><h3 id="defaultmenu" data-toc="defaultmenu">Default Menu</h3><p id="s58ouq_52">Each concept has a default transformation menu associated. If the language designer does not provide one explicitly, a transformation menu defined for the closest super-concept is assumed. If none is specified for any of the super-concepts, the one defined on&nbsp;<em id="s58ouq_53">BaseConcept</em> is used, which contains the substitute actions suitable for that position (see below the section on substitute actions).</p><p id="s58ouq_54">A default menu is used in situations where the language designer hasn't specified which menu to display.</p><figure id="s58ouq_55"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/tml1.png" class="lightbox"><img alt="tml1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/tml1.png" title="tml1.png" width="500" height="427"></a></figure></section><section class="chapter"><h3 id="namedmenu" data-toc="namedmenu">Named Menu</h3><p id="s58ouq_56">A named menu is an additional menu for a concept. Like the default menu it also specifies an applicable concept and contains a list of sections. As the term suggests, a named menu has an explicitly set name. A named menu is meant to be set as the transformation menu of a cell or included into another menu via the&nbsp;<b id="s58ouq_57">Include Menu menu part</b>.</p><figure id="s58ouq_58"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/tml2.png" class="lightbox"><img alt="tml2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/tml2.png" title="tml2.png" width="500" height="430"></a></figure><p id="s58ouq_59">Attaching a named menu to an editor cell:</p><figure id="s58ouq_60"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/image2016-5-30-17-9-40.png" class="lightbox"><img alt="image2016-5-30-17-9-40.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/image2016-5-30-17-9-40.png" title="image2016-5-30-17-9-40.png" width="500" height="372"></a></figure><p id="s58ouq_61">Note: Default transformation menus can also be attached to individual cells the same way named menus can.</p></section><section class="chapter"><h3 id="menucontributions" data-toc="menucontributions">Menu Contributions</h3><p id="s58ouq_62">A menu contribution extends a given menu by contributing additional menu parts to it. This is in particular useful, when an extending language needs to add entries into a menu defined in the extended language. Contributions can actually only be defined in languages other than the one with the menu being contributed to.</p><p id="s58ouq_63">When a menu is requested at runtime the original definition and all contributions are merged and the menu is created using the combined definition. A few important notes on contributions:</p><ol class="list _decimal" id="s58ouq_64" type="1"><li class="list__item" id="s58ouq_65"><p>The order, in which the individual definitions are merged is currently unspecified.</p></li><li class="list__item" id="s58ouq_66"><p>A contribution cannot remove menu parts from the menu it contributes to.</p></li><li class="list__item" id="s58ouq_67"><p>It is possible to define a contribution to the implicit default menu for a concept.</p></li></ol><figure id="s58ouq_68"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/tml3.png" class="lightbox"><img alt="tml3.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/tml3.png" title="tml3.png" width="500" height="183"></a></figure></section><section class="chapter"><h3 id="sectionlocations" data-toc="sectionlocations">Section locations</h3><p id="s58ouq_69">By specifying location for a section within the menu you indicate, into which part of the UI the actions should be inserted:</p><ul class="list _bullet" id="s58ouq_70"><li class="list__item" id="s58ouq_71"><p><b id="s58ouq_72">completion</b> - the completion menu</p></li><li class="list__item" id="s58ouq_73"><p><b id="s58ouq_74">context actions tool</b> - the <a href="context-actions-tool.html" id="s58ouq_75">Context Actions Tool</a> (requires import of <em id="s58ouq_76">jetbrains.mps.editor.contextActionsTool.lang.menus</em> language)</p></li><li class="list__item" id="s58ouq_77"><p><b id="s58ouq_78">context assistant</b> - the <a href="context-assistant.html" id="s58ouq_79">Context Assistant</a></p></li><li class="list__item" id="s58ouq_80"><p><b id="s58ouq_81">side transform</b> - left or right transformations</p></li></ul><figure id="s58ouq_82"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Locations1.png" class="lightbox"><img alt="Locations1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Locations1.png" title="Locations1.png" width="500" height="149"></a></figure></section><section class="chapter"><h3 id="menuparts" data-toc="menuparts">Menu Parts</h3><p id="s58ouq_83">The following standard menu parts are available:</p><ul class="list _bullet" id="s58ouq_84"><li class="list__item" id="s58ouq_85"><p id="s58ouq_86"><b id="s58ouq_87">action</b> â a&nbsp;simple menu item specifying an action to be performed, its corresponding menu text and applicability.</p></li><li class="list__item" id="s58ouq_88"><p id="s58ouq_89"><b id="s58ouq_90">group</b> - a collection of menu items. Beyond these items a group may define one or more <b id="s58ouq_91">variables</b> that are then shared by all actions within the group to avoid repetitive computation. Additionally, a group holds a <b id="s58ouq_92">condition</b> that indicates when the actions in the group should be made available to the user.</p><aside class="prompt" data-type="tip" data-title="" id="s58ouq_93"><p id="s58ouq_94">The variables are calculated eagerly before the condition of the containing group is evaluated. This makes the variables available inside the condition. On the other hand, that means that the computation of the variable initial values is performed irrespective of the result of the condition.</p><p id="s58ouq_95">If you want to protect variable computation with a condition, simply wrap the group in another group. The outer group's condition will protect the inner group's variables from unnecessary computation.</p></aside></li><li class="list__item" id="s58ouq_96"><p><b id="s58ouq_97">include</b>-&nbsp;include a specific default or named menu (together with its contributions, if any). Inclusion cycles are detected at runtime and an error message is produced.</p></li><li class="list__item" id="s58ouq_98"><p><b id="s58ouq_99">include substitute menu</b> - include a default or named substitute menu to use as part of this menu.</p></li><li class="list__item" id="s58ouq_100"><p><b id="s58ouq_101">parametrized</b> - an action that is parametrized with multiple values.</p></li><li class="list__item" id="s58ouq_102"><p><b id="s58ouq_103">submenu</b>&nbsp;â a submenu containing further parts.</p></li><li class="list__item" id="s58ouq_104"><p><b id="s58ouq_105">superconcepts menu</b> â includes the default menus of the superconcepts of the applicable concept since these are not included by default.</p></li><li class="list__item" id="s58ouq_106"><p><b id="s58ouq_107">wrap substitute menu</b> - wraps a specified concept using the provided handler</p></li></ul><p id="s58ouq_108">Language <code class="code" id="s58ouq_109">jetbrains.mps.lang.editor.menus.extras</code>&nbsp;contains adapters to include various action-like entities from transformation menus:</p><ul class="list _bullet" id="s58ouq_110"><li class="list__item" id="s58ouq_111"><p><b id="s58ouq_112">intention</b> â wraps an intention (a subconcept of <code class="code" id="s58ouq_113">BaseIntentionDeclaration</code>&nbsp;from <code class="code" id="s58ouq_114">jetbrains.mps.lang.intentions</code>).</p></li><li class="list__item" id="s58ouq_115"><p><b id="s58ouq_116">refactoring</b> â wraps a refactoring <code class="code" id="s58ouq_117">Refactoring</code>&nbsp;from <code class="code" id="s58ouq_118">jetbrains.mps.lang.refactoring</code>.</p></li><li class="list__item" id="s58ouq_119"><p><b id="s58ouq_120">plugin Action</b> â wraps a plugin action <code class="code" id="s58ouq_121">ActionDeclaration</code>&nbsp;from <code class="code" id="s58ouq_122">jetbrains.mps.lang.plugin</code>.</p></li></ul><figure id="s58ouq_123"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Oprions5.png" class="lightbox"><img alt="Oprions5.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Oprions5.png" title="Oprions5.png" width="500" height="182"></a></figure><section class="chapter"><h4 id="menuadditionalmethods" data-toc="menuadditionalmethods">Additional methods</h4><p id="s58ouq_124">The <em id="s58ouq_125">additional methods</em> section at the bottom allows the user to define utility methods that can be called from within the menu to avoid repetition. The additional methods typically perform calculations or perform tasks that are needed in multiple places of the menu definition. The additional methods must be <em id="s58ouq_126">private</em> to only be visible from within the containing node.</p></section><aside class="prompt" data-type="tip" data-title="" id="s58ouq_127"><p id="s58ouq_128">You may also like to check out a <a href="https://youtu.be/mK40e7bde_Y" id="s58ouq_129" data-external="true" rel="noopener noreferrer">video on Transformation Menu Language</a>.</p></aside></section></section><section class="chapter"><h2 id="sidetransformations" data-toc="sidetransformations">Side transformations</h2><p id="s58ouq_130">When you edit code in a text editor, you can type it either from left to right:</p><div class="code-block" data-lang="none">
      1_ press +
      1+_ press 2
      1+2_
   </div><p id="s58ouq_132">or from right to left</p><div class="code-block" data-lang="none">
      _1 press 2
      2_1 press +
      2+_1
   </div><p id="s58ouq_134">In order to emulate this behavior, MPS has side transform actions: left and right transforms. They allow you to create actions which will be available when you type on left or right part of your cell. For example, in MPS you can do the following:</p><div class="code-block" data-lang="none">
      1_ press + (red cell with + inside appears)
      1+_ press 2 (red cell disappear)
      1+2_
   </div><p id="s58ouq_136">or the following:</p><div class="code-block" data-lang="none">
      _1 press + (red cell with + inside appears)
      +_1 press 2 (red cell disappear)
      2_+1
   </div><p id="s58ouq_138">The first case is called right transform. The second case is called left transform.</p><p id="s58ouq_139">You define side transformations in the Transformation menus by choosing the <b id="s58ouq_140">side transform</b> location for the section:</p><figure id="s58ouq_141"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/SideTransforms100.png" class="lightbox"><img alt="SideTransforms100.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/SideTransforms100.png" title="SideTransforms100.png" width="500" height="194"></a></figure><p id="s58ouq_142">The language also enables language designers to include items of the side-transform menu to the completion menu on a <b id="s58ouq_143">specific cell</b>. To do this you attach to the desired cell a transformation menu that contains a&nbsp;<b id="s58ouq_144">completion</b>section. That completion section&nbsp;will hold an&nbsp;<b id="s58ouq_145">include menu</b>part and specify the location of side transform. The items of side-transform menu will be included to the completion.</p><figure id="s58ouq_146"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/cellmenu1.png" class="lightbox"><img alt="cellmenu1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/cellmenu1.png" title="cellmenu1.png" width="500" height="41"></a></figure><p id="s58ouq_147">The location of the included menu can be specified using the intention "Specify Location".</p></section><section class="chapter"><h2 id="substitutemenus" data-toc="substitutemenus">Substitute menus</h2><p id="s58ouq_148">Substitute actions define user-invoked transformations to some parts of the model, during which one node is substituted by another node. The actually mapping of these substitute actions to the visual UI elements (completion menu, etc.) is then done through Transform menus (see the section above).</p><p id="s58ouq_149">Typically substitute actions are triggered by pressing&nbsp;<em id="s58ouq_150">Ctrl + Space</em> in the editor. The completion menu that shows up contains options that, when selected by the user, will replace the node under caret.&nbsp;Unlike&nbsp;<b id="s58ouq_151">side-transformations</b> ,&nbsp;<b id="s58ouq_152">context assistant</b>&nbsp;or&nbsp;<b id="s58ouq_153">context action tool</b> ,&nbsp;<b id="s58ouq_154">substitutions</b>&nbsp;have default behavior, which takes effect, unless the language author defines otherwise.</p><section class="chapter"><h3 id="defaultbehaviorforcode-completion" data-toc="defaultbehaviorforcode-completion">Default behavior for code-completion</h3><p id="s58ouq_155">Without any menus implemented explicitly by the language author, MPS will still provide a completion menu with substitutions for the current node in either of these two cases:</p><ul class="list _bullet" id="s58ouq_156"><li class="list__item" id="s58ouq_157"><p>The caret is placed at the front of a single-cell editor &nbsp;</p><figure id="s58ouq_158"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transforms10.png" class="lightbox"><img alt="transforms10.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transforms10.png" title="transforms10.png" width="100" height="67"></a></figure><figure id="s58ouq_159"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transforms11.png" class="lightbox"><img alt="transforms11.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transforms11.png" title="transforms11.png" width="100" height="95"></a></figure></li><li class="list__item" id="s58ouq_160"><p>The user has selected the whole editor of a node</p><figure id="s58ouq_161"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transforms12.png" class="lightbox"><img alt="transforms12.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transforms12.png" title="transforms12.png" width="100" height="67"></a></figure><figure id="s58ouq_162"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/transforms13.png" class="lightbox"><img alt="transforms13.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/transforms13.png" title="transforms13.png" width="100" height="84"></a></figure></li></ul><p id="s58ouq_163">In these cases pressing <em id="s58ouq_164">Control + Space</em> will show a menu with all concepts from the imported languages applicable in the given context, which can substitute the current node in the model.</p><p id="s58ouq_165">MPS follows these steps to populate the default completion menu:</p><ol class="list _decimal" id="s58ouq_166" type="1"><li class="list__item" id="s58ouq_167"><p>If your selection is inside of a position which allows concept A, then all enabled subconcepts of A will be available in the completion menu.</p></li><li class="list__item" id="s58ouq_168"><p>All abstract concepts are excluded</p></li><li class="list__item" id="s58ouq_169"><p>All concepts, for which the 'can be a child' constraint returns false, are excluded</p></li><li class="list__item" id="s58ouq_170"><p>All concepts, for which the 'can be a parent' constraint of a parent node returns false, are excluded</p></li><li class="list__item" id="s58ouq_171"><p>If a concept contains a 1:1 reference, then it is not added to the completion menu itself. Instead, an item is added for each element in scope for that reference. We use a name <b id="s58ouq_172">smart reference</b> for such items.</p></li></ol><p id="s58ouq_173">To customize node substitutions, the&nbsp;<b id="s58ouq_174">substitute menus</b>&nbsp;are used.</p></section><section class="chapter"><h3 id="substitutemenu(default)" data-toc="substitutemenu(default)">Substitute menu (default)</h3><p id="s58ouq_175">By defining a default substitute menu for a concept you may customize the contents of the completion menu, which displays when the user presses&nbsp;<em id="s58ouq_176">Control + Space</em>. It also has effect on sub-concepts of the concept, unless these sub-concepts define their own default substitute menus.</p><figure id="s58ouq_177"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/Substitution-menu-2.png" class="lightbox"><img alt="Substitution-menu-2.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Substitution-menu-2.png" title="Substitution-menu-2.png" width="500" height="74"></a></figure><aside class="prompt" data-type="warning" data-title="" id="s58ouq_178"><p id="s58ouq_179">If you define a default substitute menu for a concept and leave it empty, the concept will not be included in the completion menu. This is the equivalent of using the <em id="s58ouq_180">IDontSubstituteByDefault</em> interface in the previous versions of MPS.</p><figure id="s58ouq_181"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/EmptyMenu1.png" class="lightbox"><img alt="EmptyMenu1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/EmptyMenu1.png" title="EmptyMenu1.png" width="500" height="78"></a></figure></aside><p id="s58ouq_182">However, if you want to assign the substitute menu to a particular cell of an editor, you will need to include your substitute menu in a transformation menu, because only transformation menus can be attached to editor cells.</p><figure id="s58ouq_183"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/IncludeDefaultSubstitute1.png" class="lightbox"><img alt="IncludeDefaultSubstitute1.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/IncludeDefaultSubstitute1.png" title="IncludeDefaultSubstitute1.png" width="500" height="99"></a></figure></section><section class="chapter"><h3 id="substitutemenu(named)" data-toc="substitutemenu(named)">Substitute menu (named)</h3><p id="s58ouq_184">Named substitute menus give you the flexibility to create multiple substitute menus and use them in different contexts. Named substitute menus must be first included in another substitute menus or transformation menus to take effect.</p></section><section class="chapter"><h3 id="substitutemenucontribution" data-toc="substitutemenucontribution">Substitute menu contribution</h3><p id="s58ouq_185">Just like with Transform menus, Substitute menu contributions contribute new entries into substitute menus defined in an extended language.</p></section><section class="chapter"><h3 id="options" data-toc="options">Options</h3><ul class="list _bullet" id="s58ouq_186"><li class="list__item" id="s58ouq_187"><p>add concept - adds a single concept to the menu</p></li><li class="list__item" id="s58ouq_188"><p>concept list - adds a collection of concepts</p></li><li class="list__item" id="s58ouq_189"><p>group - adds a groups of entries, if a condition is met</p></li><li class="list__item" id="s58ouq_190"><p>include - includes a specified menu</p></li><li class="list__item" id="s58ouq_191"><p>parameterized - adds a parametrized substitute action</p></li><li class="list__item" id="s58ouq_192"><p>reference actions -&nbsp;&nbsp;includes and customises the appearance of the possible targets of a reference</p></li><li class="list__item" id="s58ouq_193"><p>subconcepts menu - includes all subconcepts of the concept</p></li><li class="list__item" id="s58ouq_194"><p>substitute action -&nbsp;adds a single substitute action</p></li><li class="list__item" id="s58ouq_195"><p>wrap substitute menu -&nbsp;wraps a specified concept using the provided handler</p></li></ul></section></section><section class="chapter"><h2 id="interactionofcellmenuandcell-specifictransformationmenu" data-toc="interactionofcellmenuandcell-specifictransformationmenu">Interaction of Cell Menu and Cell-specific Transformation Menu</h2><p id="s58ouq_196">If a cell has both "menu" and "transformation menu" specified the applicable entries from both menus are combined. Some cell menu parts (descendants of <code class="code" id="s58ouq_197">CellMenuPart_Abstract</code>&nbsp;such as <code class="code" id="s58ouq_198">CellMenuPart_PropertyPostfixHints</code>) do not yet have an equivalent transformation/substitution menu part.</p></section><section class="chapter"><h2 id="includetransformationmenufortheproperty/reference" data-toc="includetransformationmenufortheproperty/reference">Include transformation menu for the property/reference</h2><p id="s58ouq_199">The customization of the menu for the property/reference cells can be done with the <b id="s58ouq_200">property/reference transformation menu parts</b> .&nbsp;Suppose you want to customize the completion menu of the reference/property cell. Previously, it could have been done by defining the "inline menu" in the inspector. Now it can be done also via the <b id="s58ouq_201">Transformation Menu</b>. We have introduced the property and the reference transformation menu parts. The <b id="s58ouq_202">reference transformation menu part</b> includes the actions, which set the target node to the specific reference. The target nodes come from the scope for that reference. The same goes for the property menu part: it takes the values of the property type and includes actions, which set the value to the specific properties.</p><section class="chapter"><h3 id="exampleonreferences" data-toc="exampleonreferences">Example on references</h3><p id="s58ouq_203">Suppose we want to build the completion menu for a reference cell. The menu should contain the usual targets of the reference that are in scope, plus some other custom action. That could be done by attaching the following named transformation menu to the reference cell:</p><figure id="s58ouq_204"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/ClassCreator-CompletionMenu.png" class="lightbox"><img alt="ClassCreator-CompletionMenu.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/ClassCreator-CompletionMenu.png" title="ClassCreator-CompletionMenu.png" width="700" height="245"></a></figure><p id="s58ouq_205">So we will receive all the standard reference actions as well as our custom action in the completion:</p><figure id="s58ouq_206"><img alt="Completion.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/Completion.png" title="Completion.png" width="700" height="153"></figure><p id="s58ouq_207">As you can see the reference menu part is the analog of the "primary choose referent menu" part in the "inline menu", but more customizable.&nbsp;Also, if no menu is attached to a cell, its reference menu will be used by default.</p></section><section class="chapter"><h3 id="exampleonproperties" data-toc="exampleonproperties">Example on properties</h3><p id="s58ouq_208">One more example - suppose you want to see all the possible values for a specific property in the context assistant when the caret is on a <b id="s58ouq_209">label</b>&nbsp;cell next to that property cell. Let's take a look at a piece of code in the Kaja language:</p><figure id="s58ouq_210"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/kaja-code.png" class="lightbox"><img alt="kaja-code.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/kaja-code.png" title="kaja-code.png" width="300" height="184"></a></figure><p id="s58ouq_211">We want to see all the variants of the looking direction when we place the caret to the looking cell. So we attach the following menu to this label cell:</p><figure id="s58ouq_212"><img alt="looking-direction.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/looking-direction.png" title="looking-direction.png" width="1626" height="262"></figure><p id="s58ouq_213">And get the result:</p><figure id="s58ouq_214"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/dir-cont-assist-result.png" class="lightbox"><img alt="dir-cont-assist-result.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/dir-cont-assist-result.png" title="dir-cont-assist-result.png" width="500" height="159"></a></figure><p id="s58ouq_215">The advantages of these menu parts over the "inline menu" include:</p><ol class="list _decimal" id="s58ouq_216" type="1"><li class="list__item" id="s58ouq_217"><p>They can be attached to any cell, not just reference/property cells.</p></li><li class="list__item" id="s58ouq_218"><p>They can be used in any menu location (context assistant, context menu), not only the completion.</p></li><li class="list__item" id="s58ouq_219"><p>The reference menu is more customizable (the property menu will also be customizable soon).</p></li></ol></section></section><section class="chapter"><h2 id="themenudiscoverymechanism" data-toc="themenudiscoverymechanism">The menu discovery algorithm</h2><p id="s58ouq_220">Understanding the process of how MPS picks the transformation menu will help you design menus with more confidence.</p><p id="s58ouq_221">The built-in behavior for discovery of transformation menus is to include the menu(s) of superconcept of the current concept, so by default MPS will look for a transform for the current concept, named <em id="s58ouq_222">&lt;CurrentConcept&gt;</em> _TransformationMenu, then its super-concept's menu and so on, until BaseConcept_TransformationMenu.</p><aside class="prompt" data-type="tip" data-title="" id="s58ouq_223"><p id="s58ouq_224"><em id="s58ouq_225">BaseConcept_TransformationMenu</em> really exists in MPS and contains an instruction to include the appropriate concept's substitute menu for the current link. Thanks to this a substitute menu that you define for a concept gets included and becomes available without any need to define a transformation menu explicitly.</p></aside><p id="s58ouq_226">Substitute menus are similar to transformation menus, but their discovery works in the opposite direction: where the transformation menu for a concept A includes the menus of its superconcepts (up to BaseConcept), i.e. walks up the hierarchy, the substitute menu for A includes menus for its subconcepts, because only the sub-concepts can safely replace A in the model. Note that substitute menus are a bit different from transformation menus, because they are looked up not based on the concept of an existing node, but instead based on the link's target concept.</p></section><section class="chapter"><h2 id="showitemtrace" data-toc="showitemtrace">Show Item Trace</h2><p id="s58ouq_227">To track, which transformation or substitute menu contributed a particular action to the completion menu or to the context assistant, users just press&nbsp;Control/Cmd + Alt + B&nbsp;on the completion menu entry and an interactive trace report will show up.</p><p id="s58ouq_228">Sometimes it is hard to track how the action appeared in the completion or context assistant because of there are many substitute and transformation menus including each other.&nbsp;Now you may select some action in completion (by arrows) or in the context assistant (by pressing cmd/ctrl+alt+Enter) and then press cmd/ctrl+alt+B.&nbsp;You will see the trace in the project tool. This is the trace of the menu and menu part declaration which include each other starting from the top-level menu and ending with the action declaration. If the menu or the menu part declaration is explicit and is in the project, then it has bold style in tool and you can click it and go to the declaration.</p><p id="s58ouq_229">Here's how it looks like when we place the caret at a statement, show completion for the variable reference and then invoke "Show Item Trace":</p><figure id="s58ouq_230"><a href="https://resources.jetbrains.com/help/img/idea/2024.1/ActionTrace.png" class="lightbox"><img alt="ActionTrace.png" src="https://resources.jetbrains.com/help/img/idea/2024.1/ActionTrace.png" title="ActionTrace.png" width="500" height="132"></a></figure><p id="s58ouq_231">We see that what we see in completion is the default transformation menu for the Statement which includes the menu for superconcept which is the BaseConcept. It&nbsp;in its turn includes the substitute menu for the Statement, which in it's turn wraps the menu for the Expression. Then it comes to subconcepts of Expression, one of which is the VariableReference. VariableReference is the "smart reference" concept, so it tries to find all visible target of the Variable concept. So that's how the variable reference appears in the menu for the statement.</p></section><div class="last-modified">Last modified: 11 February 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="editor-actions.html" class="navigation-links__prev">Editor Actions</a><a href="context-assistant.html" class="navigation-links__next">Context Assistant</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/storage/help-app/v6/app.js"></script></body></html>